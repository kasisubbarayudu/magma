<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Install Orchestrator · Magma Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Install Orchestrator"/><meta name="docsearch:version" content="1.2.X"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Install Orchestrator · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# Install Orchestrator"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="text/javascript" src="/init.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>1.2.X</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Magma Website</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/magma/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma/magma/wiki/Contributor-Guide" target="_self">Contributing</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://wiki.magmacore.org/" target="_self">Wiki</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Deploy Orchestrator</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Basics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/basics/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/basics/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/basics/quick_start_guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Orchestrator<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deploy Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/orc8r/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/orc8r/deploy_build">Build Orchestrator</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/magma/docs/1.2.X/orc8r/deploy_install">Install Orchestrator</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Upgrade Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/orc8r/upgrade_1_2">Upgrade to v1.2</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/orc8r/upgrade_1_1">Upgrade to v1.1</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">NMS User Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_overview">NMS Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_organizations">Multitenancy (Organizations)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_dashboard">NMS Dashboard</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_equipment">NMS Equipment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_network">NMS Network</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_subscriber">NMS Subscriber</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_traffic">NMS Traffic</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_developer">Quick-Start Guide to NMS Development</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/nms/nms_how_to_guide">NMS How To Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Access Gateway<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deploy AGWs</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/setup_deb">Setup (Bare Metal)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/config_agw">AGW Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/enodebd">eNodeB Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/config_apn">APN Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/agw_120_upgrade">Upgrade to v1.2</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/agw_110_upgrade">Upgrade to v1.1</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">AGW Development</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/tr069">Adding TR-069 support for an eNodeB</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/s1ap_tests">S1AP Integration Tests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/lte/dev_notes">Developer Notes for Access Gateway</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Feature Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/howtos/ue_metering">UE Usage Metering</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/howtos/config_agw_bridged">AGW Bridged Mode</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Federation Gateway<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deploy FeG</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/feg/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/feg/deploy_build">Building Federation Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/feg/deploy_install">Installing Federation Gateway</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">FAQ<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/faq/magma_faq">Frequently Asked Questions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Proposals<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/proposals/p001_vpn_config_from_api">Configurable VPN from Orchestrator API</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/proposals/p002_scaled_prometheus_pipeline">Scaled Prometheus Pipeline</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/1.2.X/proposals/p003_qos_enforcement">QoS Policy Configuration</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="install-orchestrator"></a><a href="#install-orchestrator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install Orchestrator</h1>
<p>This page walks through a full, vanilla Orchestrator install.</p>
<p>If you want to install a specific release version, see the notes in the
<a href="/magma/docs/1.2.X/orc8r/deploy_intro">deployment intro</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<p>This walkthrough assumes you already have the following</p>
<ul>
<li>a registered domain name</li>
<li>a blank AWS account</li>
<li>an AWS credential with admin permissions</li>
</ul>
<p>If your AWS account is not blank, this can cause errors while Terraforming.
If you know what you're doing, this is fine - otherwise, consider signing up
for a new account.</p>
<h2><a class="anchor" aria-hidden="true" id="assemble-certificates"></a><a href="#assemble-certificates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Assemble Certificates</h2>
<p>Before Terraforming specific resources, we'll assemble the relevant
certificates.</p>
<p>First, create a local directory to hold the certificates you will use for
your Orchestrator deployment. These certificates will be uploaded to AWS
Secrets Manager and you can delete them locally afterwards.</p>
<pre><code class="hljs css language-bash">mkdir -p ~/secrets/certs
<span class="hljs-built_in">cd</span> ~/secrets/certs
</code></pre>
<p>You will need the following certificates and private keys placed in this
directory</p>
<ol>
<li>The public SSL certificate for your Orchestrator domain,
with <code>CN=*.yourdomain.com</code>. This can be an SSL certificate chain, but it must be
in one file</li>
<li>The private key which corresponds to the above SSL certificate</li>
<li>The root CA certificate which verifies your SSL certificate</li>
</ol>
<p>If you aren't worried about a browser warning, you can generate self-signed
versions of these certs</p>
<pre><code class="hljs css language-bash">MAGMA_ROOT/orc8r/cloud/deploy/scripts/self_sign_certs.sh yourdomain.com
</code></pre>
<p>Alternatively, if you already have these certs, rename and move them as follows</p>
<ol>
<li>Rename your public SSL certificate to <code>controller.crt</code></li>
<li>Rename your SSL certificate's private key to <code>controller.key</code></li>
<li>Rename your SSL certificate's root CA certificate to <code>rootCA.pem</code></li>
<li>Put these three files under the directory you created above</li>
</ol>
<p>Next, with the domain certs placed in the correct directory, generate the
application certs</p>
<pre><code class="hljs css language-bash">MAGMA_ROOT/orc8r/cloud/deploy/scripts/create_application_certs.sh yourdomain.com
</code></pre>
<p>NOTE: <code>yourdomain.com</code> above should match the relevant Terraform variables in
subsequent sections. For example, if in <code>main.tf</code> the <code>orc8r_domain_name</code> is
<code>orc8r.yourdomain.com</code>, then that same domain should be used when requesting
or generating all the above certs.</p>
<p>Finally, create the <code>admin_operator.pfx</code> file, protected with a password of
your choosing</p>
<pre><code class="hljs css language-bash">$ openssl pkcs12 -<span class="hljs-built_in">export</span> -inkey admin_operator.key.pem -<span class="hljs-keyword">in</span> admin_operator.pem -out admin_operator.pfx

Enter Export Password:
Verifying - Enter Export Password:
</code></pre>
<p><code>admin_operator.pem</code> and <code>admin_operator.key.pem</code> are the files that NMS will
use to authenticate itself with the Orchestrator API. <code>admin_operator.pfx</code> is
for you to add to your keychain if you'd like to use the Orchestrator REST API
directly (on macOS, double-click the <code>admin_operator.pfx</code> file and add it to
your keychain, inputting the same password chosen above).</p>
<p>The certs directory should now look like this</p>
<pre><code class="hljs css language-bash">$ ls -1 ~/secrets/certs/

admin_operator.key.pem
admin_operator.pem
admin_operator.pfx
bootstrapper.key
certifier.key
certifier.pem
controller.crt
controller.key
fluentd.key
fluentd.pem
rootCA.pem
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="install-orchestrator-1"></a><a href="#install-orchestrator-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install Orchestrator</h2>
<p>With the relevant certificates assembled, we can move on to Terraforming
the infrastructure and application.</p>
<h3><a class="anchor" aria-hidden="true" id="initialize-terraform"></a><a href="#initialize-terraform" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initialize Terraform</h3>
<p>Create a new root Terraform module in a location of your choice by creating a
new <code>main.tf</code> file. Follow the example Terraform root module at
<code>orc8r/cloud/deploy/terraform/orc8r-helm-aws/examples/basic</code> but make sure to
override the following parameters</p>
<ul>
<li><code>nms_db_password</code> must be at least 8 characters</li>
<li><code>orc8r_db_password</code> must be at least 8 characters</li>
<li><code>orc8r_domain_name</code> your registered domain name</li>
<li><code>docker_registry</code> registry containing desired Orchestrator containers</li>
<li><code>docker_user</code></li>
<li><code>docker_pass</code></li>
<li><code>helm_repo</code> repo containing desired Helm charts</li>
<li><code>helm_user</code></li>
<li><code>helm_pass</code></li>
<li><code>seed_certs_dir</code>: local certs directory (e.g. <code>&quot;~/secrets/certs&quot;</code>)</li>
<li><code>orc8r_tag</code>: tag used when you published your Orchestrator containers</li>
</ul>
<p>If you don't know what values to put for the <code>docker_*</code> and <code>helm_*</code> variables,
go through the <a href="./deploy_build.md">building Orchestrator</a> section first.</p>
<p>Make sure that the <code>source</code> variables for the module definitions point to
<code>github.com/magma/magma//orc8r/cloud/deploy/terraform/&lt;module&gt;</code>.
Adjust any other parameters as you see fit - check the READMEs for the
relevant Terraform modules to see additional variables that can be set.</p>
<p>Finally, initialize Terraform</p>
<pre><code class="hljs css language-bash">$ terraform init

Initializing modules...

Initializing the backend...

Initializing provider plugins...

Terraform has been successfully initialized!
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="terraform-infrastructure"></a><a href="#terraform-infrastructure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Terraform Infrastructure</h3>
<p>The two Terraform modules are organized so that <code>orc8r-aws</code> contains all the
resource definitions for the cloud infrastructure that you'll need to run
Orchestrator and <code>orc8r-helm-aws</code> contains all of the application components
behind Orchestrator. On the very first installation, you'll have to
<code>terraform apply</code> the infrastructure before the application. On later changes
to your Terraform root module, you can make all changes at once with a single
<code>terraform apply</code>.</p>
<p>With your root module set up, run</p>
<pre><code class="hljs css language-bash">$ terraform apply -target=module.orc8r

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> actual resource count will depend on your root module variables</span>
Apply complete! Resources: 70 added, 0 changed, 0 destroyed.
</code></pre>
<p>This <code>terraform apply</code> will create a
<a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">kubeconfig</a>
file in the same directory as your root Terraform module. To access the
K8s cluster, either set your KUBECONFIG environment variable to point to this
file or pull this file into your default kubeconfig file at <code>~/.kube/config</code>.</p>
<p>For example, with the <code>realpath</code> utility
installed, you can set the kubeconfig with</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">export</span> KUBECONFIG=$(realpath kubeconfig_orc8r)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="terraform-secrets"></a><a href="#terraform-secrets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Terraform Secrets</h3>
<p>From your same root Terraform module, seed the certificates and secrets we
generated earlier by running</p>
<pre><code class="hljs css language-bash">$ terraform apply -target=module.orc8r-app.null_resource.orc8r_seed_secrets

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
</code></pre>
<p>The secrets should now be successfully uploaded to AWS Secrets Manager.</p>
<p>NOTE: if this isn't your first time applying the <code>orc8r_seed_secrets</code> resource,
you'll need to first
<code>terraform taint module.orc8r-app.null_resource.orc8r_seed_secrets</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="terraform-application"></a><a href="#terraform-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Terraform Application</h3>
<p>With the underlying infrastructure and secrets in place, we can now install the
Orchestrator application.</p>
<p>From your same root Terraform module, install the Orchestrator application
by running</p>
<pre><code class="hljs css language-bash">$ terraform apply

Apply complete! Resources: 16 added, 0 changed, 0 destroyed.
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="create-an-orchestrator-admin-user"></a><a href="#create-an-orchestrator-admin-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create an Orchestrator Admin User</h3>
<p>The NMS requires some basic certificate-based authentication when making
calls to the Orchestrator API. To support this, we need to add the relevant
certificate as an admin user to the controller.</p>
<p>NOTE: in the below <code>kubectl</code> commands, use the <code>-n</code> flag, or
<a href="https://github.com/ahmetb/kubectx"><code>kubens</code></a>, to select the appropriate K8s
namespace (by default this is <code>orc8r</code>). Also, assumes kubeconfig is set
correctly from above.</p>
<p>Create the Orchestrator admin user with the <code>admin_operator</code> certificate
created earlier</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">export</span> CNTLR_POD=$(kubectli -n orc8r get pod -l app.kubernetes.io/component=controller -o jsonpath=<span class="hljs-string">'{.items[0].metadata.name}'</span>)
kubectl <span class="hljs-built_in">exec</span> <span class="hljs-variable">${CNTLR_POD}</span> -- envdir /var/opt/magma/envdir /var/opt/magma/bin/accessc add-existing -admin -cert /var/opt/magma/certs/admin_operator.pem admin_operator
</code></pre>
<p>If you want to verify the admin user was successfully created, inspect the
output from</p>
<pre><code class="hljs css language-bash">$ kubectl <span class="hljs-built_in">exec</span> <span class="hljs-variable">${CNTLR_POD}</span> -- envdir /var/opt/magma/envdir /var/opt/magma/bin/accessc list-certs

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> actual values will differ</span>
Serial Number: 83550F07322CEDCD; Identity: Id_Operator_admin_operator; Not Before: 2020-06-26 22:39:55 +0000 UTC; Not After: 2030-06-24 22:39:55 +0000 UTC
</code></pre>
<p>At this point, you can <code>rm -rf ~/secrets</code> to remove the certificates from your
local disk (we recommend this for security). If you ever need to update your
certificates, you can create this local directory again and <code>terraform taint</code>
the <code>null_resource</code> to re-upload local certificates to Secrets Manager. You'll
also need to add a new admin user with the updated <code>admin_operator</code> cert.</p>
<h3><a class="anchor" aria-hidden="true" id="create-an-nms-admin-user"></a><a href="#create-an-nms-admin-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create an NMS Admin User</h3>
<p>Create an admin user for the <code>master</code> organization on the NMS</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">export</span> NMS_POD=$(kubectl get pod -l app.kubernetes.io/component=magmalte -o jsonpath=<span class="hljs-string">'{.items[0].metadata.name}'</span>)
kubectl <span class="hljs-built_in">exec</span> -it <span class="hljs-variable">${NMS_POD}</span> -- yarn setAdminPassword master ADMIN_USER_EMAIL ADMIN_USER_PASSWORD
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="dns-resolution"></a><a href="#dns-resolution" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DNS Resolution</h2>
<p>EKS has been set up with
<a href="https://github.com/kubernetes-sigs/external-dns">ExternalDNS</a>, so AWS Route53
will already have the appropriate CNAME records for the relevant subdomains of
Orchestrator at this point. You will need to configure your DNS records on
your managed domain name to use the Route53 nameservers in order to resolve
these subdomains.</p>
<p>The example Terraform root module has an output <code>nameservers</code> which will list
the Route53 nameservers for the hosted zone for Orchestrator. Access these
via <code>terraform output</code> (you have probably already noticed identical output
from every <code>terraform apply</code>). Output should be of the form</p>
<pre><code class="hljs"><span class="hljs-section">Outputs:</span>

nameservers = [
  <span class="hljs-string">"ns-xxxx.awsdns-yy.org"</span>,
  <span class="hljs-string">"ns-xxxx.awsdns-yy.co.uk"</span>,
  <span class="hljs-string">"ns-xxxx.awsdns-yy.com"</span>,
  <span class="hljs-string">"ns-xxxx.awsdns-yy.net"</span>,
]
</code></pre>
<p>If you chose a subdomain prefix for your Orchestrator domain name in your
root Terraform module, you only need to provide a single NS record to your
domain registrar, mapping the subdomain to the above name servers.
For example, for the subdomain <code>orc8r</code>, this record would notionally take
the form <code>{ orc8r -&gt; [ns-xxxx.awsdns-yy.org, ...] }</code>.</p>
<p>If you didn't choose a subdomain prefix, then you can still point the whole
domain to AWS via the single NS record. Alternatively, if this is undesirable,
provide NS records for each of the following subdomains</p>
<ol>
<li>nms</li>
<li>controller</li>
<li>bootstrapper-controller</li>
<li>api</li>
</ol>
<p>For example, for the domain <code>mydomain</code>, these records would notionally take
the form
<code>{ nms -&gt; [ns-xxxx.awsdns-yy.org, ...], controller -&gt; [ns-xxxx.awsdns-yy.org, ...], ... }</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="verify-the-deployment"></a><a href="#verify-the-deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify the Deployment</h2>
<p>After a few minutes the NS records should propagate. Confirm successful
deployment by visiting the master NMS organization at e.g.
<code>https://master.nms.yoursubdomain.yourdomain.com</code> and logging in with the
<code>ADMIN_USER_EMAIL</code> and <code>ADMIN_USER_PASSWORD</code> provided above.</p>
<p>NOTE: the <code>https://</code> is required. If you self-signed certs above, the browser
will rightfully complain. Either ignore the browser warnings at your own risk
(some versions of Chrome won't allow this at all), or e.g.
<a href="https://stackoverflow.com/questions/7580508/getting-chrome-to-accept-self-signed-localhost-certificate">import the root CA from above on a per-browser basis
</a>.</p>
<p>For interacting with the Orchestrator REST API, a good starting point is the
Swagger UI available at <code>https://api.yoursubdomain.yourdomain.com/apidocs/v1/</code>.</p>
<p>If desired, you can also visit the AWS endpoints directly. The relevant
services are <code>nginx-proxy</code> for NMS and <code>orc8r-proxy</code> for Orchestrator API.
Remember to include <code>https://</code>, as well as the port number for non-standard
TLS ports.</p>
<pre><code class="hljs css language-bash">$ kubectl get services

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> values will differ, e.g. the EXTERNAL-IP column</span>
NAME                            TYPE           CLUSTER-IP       EXTERNAL-IP                       PORT(S)                                                     AGE
magmalte                        ClusterIP      172.20.180.24    &lt;none&gt;                            8081/TCP                                                    3h13m
nginx-proxy                     LoadBalancer   172.20.158.22    www.us-west-2.elb.amazonaws.com   443:30086/TCP                                               3h13m
orc8r-alertmanager              ClusterIP      172.20.65.247    &lt;none&gt;                            9093/TCP                                                    3h13m
orc8r-alertmanager-configurer   ClusterIP      172.20.56.14     &lt;none&gt;                            9101/TCP                                                    3h13m
orc8r-bootstrap-nginx           LoadBalancer   172.20.121.250   xxx.us-west-2.elb.amazonaws.com   80:31106/TCP,443:32187/TCP,8444:32707/TCP                   3h13m
orc8r-clientcert-nginx          LoadBalancer   172.20.126.56    yyy.us-west-2.elb.amazonaws.com   80:32077/TCP,443:30520/TCP,8443:30665/TCP                   3h13m
orc8r-controller                ClusterIP      172.20.29.196    &lt;none&gt;                            ...                                                         3h13m
orc8r-nginx-proxy               LoadBalancer   172.20.184.203   zzz.us-west-2.elb.amazonaws.com   80:30619/TCP,8443:32592/TCP,8444:31336/TCP,443:32148/TCP    3h13m
orc8r-prometheus                ClusterIP      172.20.140.123   &lt;none&gt;                            9090/TCP                                                    3h13m
orc8r-prometheus-cache          ClusterIP      172.20.136.37    &lt;none&gt;                            9091/TCP                                                    3h13m
orc8r-prometheus-configurer     ClusterIP      172.20.39.188    &lt;none&gt;                            9100/TCP                                                    3h13m
orc8r-user-grafana              ClusterIP      172.20.231.56    &lt;none&gt;                            3000/TCP                                                    3h13m
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="upgrade-the-deployment"></a><a href="#upgrade-the-deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrade the Deployment</h2>
<p>You can upgrade the deployment by changing one or both of the following
variables in your root Terraform module, before running <code>terraform apply</code></p>
<ul>
<li><code>orc8r_tag</code> container image version</li>
<li><code>orc8r_chart_version</code> Helm chart version</li>
</ul>
<p>Changes to the Terraform modules between releases may require some updates to
your root Terraform module - these will be communicated in release notes.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/magma/docs/1.2.X/orc8r/deploy_build"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/magma/docs/1.2.X/orc8r/upgrade_1_2"><span>Upgrade to v1.2</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#assemble-certificates">Assemble Certificates</a></li><li><a href="#install-orchestrator-1">Install Orchestrator</a><ul class="toc-headings"><li><a href="#initialize-terraform">Initialize Terraform</a></li><li><a href="#terraform-infrastructure">Terraform Infrastructure</a></li><li><a href="#terraform-secrets">Terraform Secrets</a></li><li><a href="#terraform-application">Terraform Application</a></li><li><a href="#create-an-orchestrator-admin-user">Create an Orchestrator Admin User</a></li><li><a href="#create-an-nms-admin-user">Create an NMS Admin User</a></li></ul></li><li><a href="#dns-resolution">DNS Resolution</a></li><li><a href="#verify-the-deployment">Verify the Deployment</a></li><li><a href="#upgrade-the-deployment">Upgrade the Deployment</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2025 The Magma Authors</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f95caeb7bc059b294eec88e340e5445b',
                indexName: 'magma',
                inputSelector: '#search_input_react'
              });
            </script></body></html>