<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>AGW with Bazel · Magma Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# AGW with Bazel"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="AGW with Bazel · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# AGW with Bazel"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="text/javascript" src="/init.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Magma Website</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/magma/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma/magma/wiki/Contributor-Guide" target="_self">Contributing</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://wiki.magmacore.org/" target="_self">Wiki</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Getting Started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/quick_start_guide">Quick Start Guide</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/magma/docs/next/bazel/agw_with_bazel">AGW with Bazel</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Operate your own private mobile network with Charmed Magma</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/00_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/01_getting_started">1. Getting Started</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/02_deploying_magma_orchestrator">2. Deploying Magma Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/03_deploying_magma_agw">3. Deploying Magma Access Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/04_integrating_agw_with_orc8r">4. Integrating Magma Access Gateway with Magma Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/05_deploying_the_radio_simulator">5. Deploying the radio simulator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/06_simulating_user_traffic">6. Simulating user traffic</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/06_destroying_the_env">7. Destroying the environment</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Usage<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">How-To</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/ue_metering">UE Usage Metering</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/config_agw_bridged">AGW Non-NAT Mode</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/5g_nsa_support">5G NSA Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/call_tracing">Call Tracing</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/events_monitoring">Events Monitoring</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/ipv6_agw">(Experimental) Configure IPv6 AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/he_api">Header Enrichment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/inbound_roaming">Inbound Roaming</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/l3_transport">L3 transport for AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/network_probe">Network Probe</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/package">Packaging</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dashboard">Dashboard</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/equipment">Equipment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/network">Network</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/subscriber">Subscriber</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/traffic">Traffic</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/metrics">Metrics</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/alerts">Alerts</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/federation">Federation</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/admin">Admin</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/tips_and_tricks">Tips and Tricks</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/architecture_overview">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/architecture_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/architecture_modularity">Modularity</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/architecture_security">Security</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/architecture_overview">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">FeG</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/architecture_overview">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Domain Proxy</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/dp/architecture_overview">Overview</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Deploy<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/general/aws_cloudstrapper">AWS Cloudstrapper Install</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_install">Install AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_install_docker">Install Docker AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_config_agw">Configure AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_config_enodebd">Configure eNodeB</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_config_apn">Configure an APN</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_agw_using_juju">Deploy AGW using Juju</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/build_install_magma_pkg_in_agw">Build and install a magma package in AGW</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_install">Install Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_using_ansible">Deploy Orchestrator using Ansible (Beta)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_using_juju">Deploy Orchestrator using Juju (Beta)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_terraform_options">Terraform Options</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_faq">FAQs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/deploy_setup">Set Up NMS</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federation Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_build">Build FeG</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_install">Install FeG</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Domain Proxy</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/dp/deploy_build">Build and deployment</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Carrier WiFi</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/deploy_build">Building Carrier Wifi Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/deploy_install">Installing Carrier Wifi Gateway</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Configure<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/configure_agw_ha">Configure AGW for HA</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/configure_sentry">Sentry Integration</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/configure_thanos">Thanos</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federation Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/configure_federation">Configure FeG</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/nms_organizations">Multitenancy (Organizations)</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Upgrade<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/general/upgrade_intro">Introduction</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_debian_to_ubuntu">Migrate AGWs to Ubuntu</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_6">Upgrade to v1.6</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_5">Upgrade to v1.5</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_4">Upgrade to v1.4</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_3">Upgrade to v1.3</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_2">Upgrade to v1.2</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_1">Upgrade to v1.1</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_6">Upgrade to v1.6</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_5">Upgrade to v1.5</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_4">Upgrade to v1.4</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_3">Upgrade to v1.3</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_2">Upgrade to v1.2</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_1">Upgrade to v1.1</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Debug<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/agw_healthcheck">Perform Access Gateway health check</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/agw_unable_to_checkin">Access Gateway Unable to Check-in to Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/user_unable_to_attach">User is unable to attach to Magma</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/update_certificates">Update rootCA and controller SSL certificates</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/generate_admin_operator_certificates">Generate and update admin_operator certificates</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/analyze_service_crashes_in_agw">Analyze Service crashes in AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/datapath_connectivity">Debugging AGW datapath issues</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/debug_show_tech">Show Tech</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/debug_dp_probe">Datapath Probe CLI</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/debug_user_control_plane">User Control Plane trace CLI</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federated Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/debug_cli">FeG CLI</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Carrier WiFi</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/healthchecker">Health Checker</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/pipelined_packet_tracer_debugging">Pipelined Packet Tracer Debugging</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/debug_logs">View Logs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/alerts_troubleshooting">Alerts</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Domain Proxy</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/dp/debug_logs">Debugging and logs</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Contribute<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_github">Community</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_codeowners">Codeowners Workflow</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_tsc_norms">TSC Processes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_proposals">Proposals Process</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Technical Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/resources/ref_pcap">PCAP Collection</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/resources/ref_useful_links">Useful Links</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/resources/ref_magma_metrics">Life of a Magma Metric</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/readme_agw">Services/Sub-Components</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/dev_notes">Developer Notes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/openvswitch">Magma Datapath</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/pipelined">Pipelined</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/ebpf_datapath">Magma eBPF Datapath</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/ipfix">Magma IPFIX Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/pipelined_tests">Pipelined testing framework</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/dev_unit_testing">Test AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/tr069">Add eNB TR-069 Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/s1ap_tests">S1AP Integration Tests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/eventd">Event Reporting</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/sessiond">Session Management in Magma</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/access_service_restrictions">Restricting Network Access</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/dev_teid_allocation">TEID Allocation</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/integrated_5g_sa">Integrated 5G SA</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/extended_5g_sa_features">Extended 5G SA Features</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/suci_extensions">SUCI Extensions</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/redirectd">Redirection</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/readme_callflow">Building the Callflow</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_rest_api">REST API</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_build">Build Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_testing">Test Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_minikube">Deploy on Minikube</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_security">Security</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_indexers">State Indexers</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_sub_digests">Subscriber Digests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_rest_api_auth">REST API Auth</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_dependencies">Module Dependencies</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_gateway_registration">Gateway Registration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_aws_stack">AWS Stack</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_spacing">Spacing Guidelines</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_testing">Test NMS</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_themes">Themes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_components">Components</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federation Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/dev_testing">Test Federation Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/docker">FeG Docker Setup</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/s1ap_federated_tests">S1AP Federated Integration Tests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/session_proxy">Session Proxy</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Carrier WiFi</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/dev_testing">Test CWAG</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Design Documents<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p001_vpn_config_from_api">Configurable VPN from Orchestrator API</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p005_call_tracing">Call Tracing for Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p014_proposal_process">Magma Proposals</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p015_tech_debt_week">Tech Debt Week Processes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p017_apn_refactoring">APN Refactoring Proposal</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p003_qos_enforcement">QoS Policy Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p004_fua_restrict_feature">Service Restriction Feature</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p007_header_enrichment">Header enrichment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p008_apn_correction">MME APN Correction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p013_Ubuntu_upgrade">AGW Ubuntu upgrade</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p018_control_network_metrics">Export Control Path Network Metrics</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p019_enodeb_cbrs_support">Enodebd CBRS Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p020_sgi_tunnel_transport">L3 transport for AGW</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p002_scaled_prometheus_pipeline">Scaled Prometheus Pipeline</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p010_subscriber_scaling">Subscriber Scaling</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p011_victoriametrics">VictoriaMetrics as Magma&#x27;s TSDB</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p009_nms_mariadb_migration">NMS MariaDB Migration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p016_nms_regression_testing">NMS Regression Testing</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">FAQ<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/faq/faq_magma">Frequently Asked Questions</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="agw-with-bazel"></a><a href="#agw-with-bazel" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AGW with Bazel</h1>
<p>This page provides a Bazel-specific overview on building and testing the Magma Access Gateway (AGW).
This documentation is aimed mainly at Magma developers. For general Bazel support at Magma there is also the Slack channel <a href="https://magmacore.slack.com/archives/C033S1CEAUU">#bazel</a>.</p>
<p>Questions related to Bazel may not be specific to Magma and the <a href="https://bazel.build/reference">official Bazel reference</a> and the <code>bazel help</code> command are both very useful in these cases.</p>
<blockquote>
<p>Note: A guide on how the AGW Make commands translate to Bazel can be found in the <a href="https://github.com/magma/magma/wiki/Bazel-vs.-Make-commands-dictionary">GitHub Wiki</a>.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="what-is-bazel"></a><a href="#what-is-bazel" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is Bazel?</h2>
<p><a href="https://bazel.build/about">Bazel</a> is an open-source build system that is intended for multi-language mono-repos like Magma. Bazel is focused on fast, scalable, parallel and reproducible builds. A core strength of Bazel is an extensive <a href="#caching">caching framework</a> based on a strict and fine grained build graph.</p>
<h3><a class="anchor" aria-hidden="true" id="structure-and-files"></a><a href="#structure-and-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Structure and files</h3>
<p>The basic structure of the Bazel files in Magma is as follows:</p>
<pre><code class="hljs css language-bash">.
├── WORKSPACE.bazel
├── .bazelrc
├── BUILD.bazel
├── bazel
│   ├── bazelrcs
│   │   ├── vm.bazelrc
│   │   └── ...
│   ├── external
│   │   ├── BUILD.bazel
│   │   ├── sentry_native.BUILD
│   │   ├── requirements.in
│   │   ├── requirements.txt
│   │   └── ...
│   ├── scripts
│   │   ├── bazel_diff.sh
│   │   ├── run_buildifier.sh
│   │   └── ...
│   ├── BUILD.bazel
│   ├── cpp_repositories.bzl
│   ├── go_repositories.bzl
│   ├── python_repositories.bzl
│   ├── python_swagger.bzl
│   └── ...
├── lte
│   ├── gateway
│   │   └── python
│   │       ├── magma
│   │       │   ├── mobilityd
│   │       │   │   ├── tests
│   │       │   │   │   └── BUILD.bazel
│   │       │   │   └── BUILD.bazel
│   │       │   └── policydb
│   │       │       ├── servicers
│   │       │       │   └── BUILD.bazel
│   │       │       ├── tests
│   │       │       │   └── BUILD.bazel
│   │       │       └── BUILD.bazel
│   │       └── BUILD.bazel
│   ├── protos
│   │   ├── oai
│   │   │   └── BUILD.bazel
│   │   └── BUILD.bazel
│   └── swagger
│       └── BUILD.bazel
.
</code></pre>
<ul>
<li><a href="https://bazel.build/concepts/build-ref#workspace"><code>WORKSPACE.bazel</code></a>: Defines a Bazel project. Configuration of <a href="https://bazel.build/extending/rules">Bazel rules</a> to be used in the project.</li>
<li><a href="https://bazel.build/run/bazelrc"><code>.bazelrc</code></a>: General configuration of flags for commands.</li>
<li><a href="https://bazel.build/concepts/build-files"><code>BUILD.bazel</code></a>: A file, e.g. <code>lte/gateway/python/magma/mobilityd/BUILD.bazel</code>, in which sources are defined in binaries, libraries and tests. A <code>BUILD.bazel</code> file defines a <a href="https://bazel.build/concepts/build-ref#packages">Bazel package</a>.</li>
<li><code>bazel/</code>: Centralized folder for custom Bazel definitions and configuration of external sources.</li>
<li><code>bazel/scripts/</code>: Centralized folder for Bash wrapper scripts for Bazel, e.g. for running the <a href="#starlark-formatter">Starlark formatter</a>, <a href="#bazel-diff">Bazel-diff</a> or the <a href="#lte-integration-tests">LTE integration tests</a>.</li>
<li><code>bazel/bazelrcs/name.bazelrc</code>: Configuration of flags for commands in different environments.</li>
<li><code>bazel/name.bzl</code>
<ul>
<li>Custom Bazel code - these are custom <a href="https://bazel.build/extending/rules">Bazel rules</a>, configuration of the tool chain and external dependencies.</li>
<li>In <code>cpp</code>, <code>go</code> and <code>python_repositories.bzl</code>, external repositories are specified. These can be local repositories (folder in the environment) or git repositories.</li>
</ul></li>
<li><code>bazel/external/name.BUILD</code>: <code>.BUILD</code> files for external repositories that are not bazelified.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="starlark-formatter"></a><a href="#starlark-formatter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starlark formatter</h4>
<p>To ensure the standardized formatting of all <code>BUILD.bazel</code> and <code>.bzl</code> files the Starlark formatter <a href="https://github.com/bazelbuild/buildtools/tree/master/buildifier">buildifier</a> is used and run in <a href="#workflows">CI</a>.</p>
<p>You can also run the Starlark format check locally, from your host or from any <a href="#environments">Magma environment</a>.</p>
<p>To run the Starlark format check locally, run</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
./bazel/scripts/run_buildifier.sh check
</code></pre>
<p>To run the Starlark formatter and to fix most errors that occur during the check, run</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
./bazel/scripts/run_buildifier.sh format
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="environments"></a><a href="#environments" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environments</h3>
<p>The following Magma environments currently support Bazel:</p>
<ul>
<li>Docker
<ul>
<li><strong>devcontainer</strong>
<ul>
<li>The devcontainer is defined in <code>.devcontainer/Dockerfile</code> and meant for local development. The docker image is published at <a href="https://github.com/magma/magma/pkgs/container/magma%2Fdevcontainer"><code>ghcr.io/magma/magma/devcontainer:latest</code></a>.</li>
</ul></li>
<li><strong>Bazel-base</strong>
<ul>
<li>The Bazel-base docker container is a minimal container where only required dependencies are installed. While this image is mainly intended to be used in CI, it can also be useful for local testing. The Bazel-base image is defined in <code>.devcontainer/bazel-base/Dockerfile</code> and published at <a href="https://github.com/magma/magma/pkgs/container/magma%2Fbazel-base"><code>ghcr.io/magma/magma/bazel-base:latest</code></a>.</li>
</ul></li>
</ul></li>
<li>Vagrant VMs
<ul>
<li><strong>magma-dev</strong>
<ul>
<li>The magma-dev virtual machine is intended for local development and for extended testing in CI. It can be used to run the Magma AGW services, as well as e.g. the <a href="#python-sudo-tests">Python sudo tests</a>.</li>
</ul></li>
<li><strong>magma-test</strong>
<ul>
<li>The magma-test virtual machine is used in CI to run the <a href="#lte-integration-tests">LTE integration tests</a>.</li>
</ul></li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="caching"></a><a href="#caching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caching</h3>
<p>Bazel has a very extensive and granular system of caching intermediate build outputs, artifacts and even test results. Builds that have many cache hits are much faster than builds without cache hits.</p>
<p>The number of cache hits is reported at the end of each build, e.g. as <code>INFO: 4449 processes: 703 disk cache hit, 2377 internal, 1367 processwrapper-sandbox, 2 worker.</code>. Without code changes it should be possible to cache essentially all processes.</p>
<p>Whenever cacheable results are produced, a local cache entry is generated in the <a href="https://bazel.build/remote/caching#disk-cache">disk cache</a>. Some of the cache locations can be found by running <code>bazel info</code> and looking e.g. at the <code>repository_cache</code> entry.</p>
<blockquote>
<p>Info: A useful guide on <a href="https://github.com/magma/magma/wiki/Bazel-cache-analysis">Bazel cache analysis</a> can be found on the GitHub Wiki pages.</p>
</blockquote>
<p>In CI, caches have to be downloaded from elsewhere, this can be done either via <a href="#docker-bazel-cache">Docker images that contain pre-built caches</a>, <a href="#github-cache">GitHub caching</a> or by using a <a href="#bazel-remote-cache">remote cache</a>. <a href="#bazel-remote-cache">Remote caching</a> is the recommended way of caching for Bazel in CI. Remote caches can be used in any environment (Docker, Vagrant, etc.) and the remote cache is always up-to-date, as cache entries are constantly being uploaded. Remote caching can also be simpler than other caching approaches, in particular when using the <a href="#google-cloud-storage">Google cloud backend</a>.</p>
<h4><a class="anchor" aria-hidden="true" id="docker-bazel-cache"></a><a href="#docker-bazel-cache" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Bazel cache</h4>
<p>The Docker Bazel caches are Docker containers that contain pre-built Bazel caches for all relevant <a href="#targets">targets</a> and <a href="#configurations">configurations</a>. The containers are created in the <a href="#workflows">workflow</a> <code>docker-builder-devcontainer.yml</code> on a regular basis. The Docker Bazel cache containers are based on the <a href="#environments">Bazel-base</a> Docker container with the addition of the Bazel caches. The images are published at:</p>
<ul>
<li><code>ghcr.io/magma/magma/bazel-cache-plain:latest</code></li>
<li><code>ghcr.io/magma/magma/bazel-cache-asan:latest</code></li>
<li><code>ghcr.io/magma/magma/bazel-cache-prod:latest</code></li>
</ul>
<p>The Docker Bazel caches were introduced in <a href="https://github.com/magma/magma/issues/14562">#14562</a> - this issue also contains a detailed slide with information on the Docker Bazel cache setup.</p>
<h4><a class="anchor" aria-hidden="true" id="github-cache"></a><a href="#github-cache" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GitHub cache</h4>
<p>GitHub Actions provides a generic <a href="https://github.com/actions/cache">built-in caching solution</a>, which can be used to store the Bazel disk cache. Possible downsides of this caching approach, as with the <a href="#docker-bazel-cache">Docker caches</a>, are that the cache is not managed by Bazel and has to be kept up-to-date and below a reasonable cache size. The GitHub cache has a 10GB limit and is also used for other purposes at Magma, such as caching Vagrant base images.</p>
<h4><a class="anchor" aria-hidden="true" id="bazel-remote-cache"></a><a href="#bazel-remote-cache" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bazel remote cache</h4>
<p><a href="https://bazel.build/remote/caching">Remote caching</a> is an integrated caching mechanism that is part of Bazel. Cache entries are up-/downloaded to/from a backend server. There are many different backends that can be used, such as <a href="#google-cloud-storage">Google Cloud Storage</a> or the <a href="#buchgrbazel-remote">buchgr/bazel-remote</a>. Various backends are also documented in the <a href="https://bazel.build/remote/caching">official documentation</a>. To optimize the build times, the backend should be as close as possible to the CI runners, ideally in the same data center.</p>
<h5><a class="anchor" aria-hidden="true" id="google-cloud-storage"></a><a href="#google-cloud-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Google Cloud Storage</h5>
<p>The simplest and best supported backend for Bazel remote caching is Google Cloud Storage. With Google Cloud Storage a simple storage bucket is sufficient to operate the remote cache - for details see the <a href="https://bazel.build/remote/caching#cloud-storage">official documentation</a>.</p>
<h5><a class="anchor" aria-hidden="true" id="buchgrbazel-remote"></a><a href="#buchgrbazel-remote" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>buchgr/bazel-remote</h5>
<p>The <a href="https://github.com/buchgr/bazel-remote/">buchgr/bazel-remote</a> is a self-hosted Bazel remote caching backend that runs as a Docker container.</p>
<blockquote>
<p>Info: As of the 4th of January 2023 the bazel-remote cache for Magma is <strong>deprecated</strong>. The tear-down is documented in the issue <a href="https://github.com/magma/magma/issues/14796">#14796</a>.</p>
</blockquote>
<p>Information on the bazel-remote caching infrastructure for Magma can be found in the <a href="https://github.com/magma/ci-infra/blob/master/bazel/remote_caching/Readme.md">magma/ci-infra/bazel/remote_caching</a> repository (CI codeowner access only). This information in particular details how the bazel-remote cache can be deployed on AWS using Terraform. General information on Bazel remote caching can be found in the <a href="https://bazel.build/remote/caching">official Bazel documentation</a>.</p>
<p>Furthermore, there are GitHub Wiki pages with information on <a href="https://github.com/magma/magma/wiki/Bazel-remote-caching">how to use a deployment of the bazel-remote cache</a> and on <a href="https://github.com/magma/magma/wiki/Bazel-remote-caching-disaster-recovery-plan">how to recover from a bazel-remote cache failure</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="commands"></a><a href="#commands" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Commands</h3>
<p>The Bazel commands are structured around verbs like <a href="#building"><code>build</code></a>, <a href="#testing"><code>test</code></a> or <a href="#querying"><code>query</code></a>. The complete list of Bazel commands can be found in the <a href="https://bazel.build/run/build#available-commands">official command reference</a>. The following sections go into more detail on the most common commands.</p>
<h2><a class="anchor" aria-hidden="true" id="building"></a><a href="#building" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building</h2>
<p>To build something with Bazel, use the command <a href="https://bazel.build/run/build"><code>bazel build</code></a> and then specify the <a href="#targets">targets</a> that you want to build, e.g. <code>bazel build //lte/gateway/python/magma/mobilityd:mobilityd</code>.</p>
<p>Building happens in a sandbox, i.e. various host properties are not present at build time. This includes environment variables and stdin. The build artifacts can be found in <code>$MAGMA_ROOT/bazel-bin</code>, e.g. <code>$MAGMA_ROOT/bazel-bin/lte/gateway/python/magma/mobilityd/mobilityd</code>.</p>
<blockquote>
<p>Info: Information on debugging Bazel builds can be found in the section <a href="#debugging">debugging</a>.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="targets"></a><a href="#targets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Targets</h3>
<p>The Bazel project structure is organized around targets in the build files, written in the <a href="https://github.com/bazelbuild/starlark">Starlark language</a>. Targets usually have at least the attributes <code>name</code>, <code>srcs</code>, <code>deps</code>, but there may be many more attributes. The list of possible attributes depends on the Bazel rule.</p>
<p>A <code>cc_library</code> target, for example, could look like this:</p>
<pre><code class="hljs css language-starlark">cc_library(
    <span class="hljs-attr">name</span> = <span class="hljs-string">"my_library"</span>,
    <span class="hljs-attr">srcs</span> = [<span class="hljs-string">"my_code.c"</span>],
    <span class="hljs-attr">hdrs</span> = [<span class="hljs-string">"my_header.h"</span>],
    <span class="hljs-attr">deps</span> = [<span class="hljs-string">"//other/path:other_library"</span>],
)
</code></pre>
<p>This example is a C-library with one source file <code>my_code.c</code>, header <code>my_header.h</code> and a build dependency to another library <code>//other/path:other_library</code>. The attribute name <code>my_library</code> is the name of the Bazel target. It can be used for building the target directly, by running <code>bazel build //lib/path:my_library</code>, or for referencing the target as a dependency in another target.</p>
<p>The official Bazel documentation provides a complete list of all attributes of the <a href="https://bazel.build/reference/be/c-cpp">C/C++ rules</a>, the <a href="https://bazel.build/reference/be/python">Python rules</a>, the <a href="https://github.com/bazelbuild/rules_go">Go rules</a> and many others.</p>
<p>Some Bazel rules that are used in the Magma AGW are:</p>
<ul>
<li><code>cc_library</code>, <code>py_library</code> and <code>go_library</code> are used to group C, C++, Python and Go code respectively.</li>
<li><code>cc_binary</code>, <code>py_binary</code>, <code>go_binary</code> are used for the definitions of the C, C++, Python and Go AGW services and scripts, e.g. the <code>//lte/gateway/c/core:agw_of</code> target for MME, the <code>//lte/gateway/python/magma/pipelined</code> target for pipelined or the <code>//feg/gateway/services/envoy_controller</code> target for the envoy controller.</li>
<li><code>cc_test</code> and <code>go_test</code> are used for C, C++ and Go unit tests.</li>
<li><code>pytest_test</code> is a wrapper around <code>py_test</code>. This rule type is used for Python unit tests, the <a href="#lte-integration-tests">LTE integration tests</a> and the <a href="#python-sudo-tests">Python sudo tests</a>.</li>
<li><code>proto_library</code>, <code>cpp_proto_library</code>, <code>python_proto_library</code>, <code>cpp_grpc_library</code>, <code>python_grpc_library</code> are used to group proto code, as well as for providing proto and grpc code for C++ and Python respectively.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="target-visibility"></a><a href="#target-visibility" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Target visibility</h4>
<p>Bazel targets have a <a href="https://bazel.build/concepts/visibility">visibility attribute</a>. Per default a target's visibility is set to private and the target is only accessible for targets within the same package. Possible values include (among others) a public visibility <code>//visibility:public</code> (accessible from all packages) or package specific visibility <code>//foo/bar:__pkg__</code>, to grant targets in package <code>//foo/bar</code> access. The visibility can be set explicitly for a target or globally for the whole package.</p>
<p>The following coding guidelines should be applied when adding new targets. One important motivation for the guidelines below is based on encapsulation, i.e. keeping a clean architecture by restricting access to targets. For example, service libraries should only be accessed by the service itself. Proto and utility libraries can be accessed by any service (with certain restrictions if appropriate - e.g. the <code>all_python_proto</code> target should only be accessed by the <code>state</code> service).</p>
<ul>
<li>Protos <code>BUILD.bazel</code> files: The global package visibility is set to public as compiled protos libraries need to be accessed from a lot of packages. The visibility of native proto libraries is set to private or is restricted to package visibility for other protos packages.</li>
<li>Service <code>BUILD.bazel</code> files: The global package visibility is set to private (i.e. default). The binaries should explicitly be set to private for readability reasons, even if this means redundancy. Libraries should explicitly be set to private or package visibility (e.g. for testing) when needed. The public visibility should be used only if necessary.</li>
<li>Utility Packages: In the <code>orc8r/configuration</code> and <code>orc8r/common</code> <code>BUILD.bazel</code> files, the global package visibility is set to public.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="target-command-line-syntax"></a><a href="#target-command-line-syntax" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Target command line syntax</h3>
<p>A complete description of the <a href="https://bazel.build/run/build">syntax for specifying targets</a> can be found in the official Bazel documentation. Here we provide a list of some useful examples:</p>
<ul>
<li>To build all targets in the Bazel workspace, excluding the ones <a href="https://bazel.build/reference/be/common-definitions#common.tags">tagged as manual</a>, use <code>bazel build ...</code> or <code>bazel build //...</code>.</li>
</ul>
<blockquote>
<p>Warning: Building all targets for the first time, i.e. without any caches, can overwhelm some systems, due to the amount of parallelization. The number of parallel jobs that Bazel runs in parallel can be limited with the <code>--jobs</code> flag, e.g. on a system with 8 physical CPU cores, one could use <code>--jobs 7</code> for the initial build.</p>
</blockquote>
<ul>
<li>To build all targets inside of a folder, e.g. <code>lte/gateway</code>, use <code>bazel build //lte/gateway/...</code>.</li>
<li>To build one target, use e.g. <code>bazel build //lte/gateway/python/magma/mobilityd:mobilityd</code>. Here the <code>//</code> indicates the start of the path to the target and the <code>:</code> indicates the start of the target name.
<ul>
<li>The same target can be built with <code>bazel build //lte/gateway/python/magma/mobilityd</code> as this expands to the target with the same name as the folder.</li>
</ul></li>
<li>To specify multiple targets or multiple folders, simply add them to the command line, e.g. <code>bazel build //lte/gateway/python/magma/mobilityd:mobilityd //orc8r/gateway/...</code>. This example will build the mobilityd service target, as well as all targets inside the <code>orc8r/gateway</code> folder.</li>
</ul>
<p>When specifying targets on the command line, the leading <code>//</code> are optional, but they make it clearer that a target is referenced. The prefix <code>//</code> is required in build files when a dependency is referenced.</p>
<p>A complete list of <a href="https://bazel.build/reference/command-line-reference">command line arguments</a> can be found in the official Bazel documentation.</p>
<h4><a class="anchor" aria-hidden="true" id="alias-targets"></a><a href="#alias-targets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alias targets</h4>
<p>For developer convenience there are <a href="https://bazel.build/reference/be/general#alias">alias targets</a> for all AGW services. An alias is simply a more convenient label for a target.</p>
<p>The service aliases for the AGW are defined in the top level <code>BUILD.bazel</code> file, in order to keep the labels as short as possible. An alias target, e.g. for the mobilityd service, looks like this:</p>
<pre><code class="hljs css language-Starlark"><span class="hljs-built_in">alias</span>(
    <span class="hljs-built_in">name</span> = <span class="hljs-string">"mobilityd"</span>,
    actual = <span class="hljs-string">"//lte/gateway/python/magma/mobilityd:mobilityd"</span>,
)
</code></pre>
<p>Instead of using the label <code>//lte/gateway/python/magma/mobilityd:mobilityd</code>, the shorter, more convenient label <code>//:mobilityd</code> can be used to refer to the target on the command line.</p>
<h3><a class="anchor" aria-hidden="true" id="configurations"></a><a href="#configurations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configurations</h3>
<p>Targets can be built with different configurations. Configurations are specified on the command line by adding the command line flag <code>--config=&lt;config_name&gt;</code>. Definitions of configurations can be found in the <code>.bazelrc</code> file. A configuration is specified by a Bazel command followed by a colon, the name of the configuration and the content, e.g. <code>build:example --announce_rc --color=yes</code>.</p>
<p>The most important configurations for Magma are:</p>
<ul>
<li>Plain, i.e. no special configuration, this is the development version of the targets.</li>
<li><code>production</code>, which is the production version of the targets used for releases.</li>
<li><code>asan</code>, a configuration with the address sanitizer enabled, used for finding memory corruption bugs.</li>
<li><code>lsan</code>, a configuration with the leak sanitizer enabled, used for finding run-time memory leaks.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="inheritance"></a><a href="#inheritance" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inheritance</h4>
<p>When editing configurations and options in the <code>.bazelrc</code> file, one has to be aware of the <a href="https://bazel.build/run/bazelrc#option-defaults">precedence and inheritance</a> of the bazel commands, as well as the effects of the <a href="https://bazel.build/reference/command-line-reference">options</a>.</p>
<p>For example, the options specified on the command line take precedence over options specified in the <code>.bazelrc</code> file. The commands <code>test</code>, <code>run</code>, <code>clean</code> and <code>info</code> inherit all options from <code>build</code>. The command <code>coverage</code> inherits from <code>test</code>. All commands inherit options from the specifier <code>common</code>.</p>
<p>Inversely, this also means that when options, such as <code>--verbose_test_summary</code>, are set for the <code>test</code> command, they are not used by the <code>build</code> command. In general, options should be set at the highest possible command level, i.e. <code>build</code> would be preferable over <code>test</code>, and <code>common</code> should be used whenever possible.</p>
<p>When options are added to the <code>test</code> command that are marked as <code>affects_outputs</code> in the <a href="https://bazel.build/reference/command-line-reference#test-options">Bazel command line reference</a>, this can lead to slower builds and less cache hits if the option is not set at the <code>build</code> or <code>common</code> level. This is because the cache entries for the two commands, for the same target, will be different. A detailed description of this problem, with possible solutions, can also be found in the issue <a href="https://github.com/magma/magma/issues/13073">#13073</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="dependencies"></a><a href="#dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies</h3>
<p>The <code>deps</code> attribute is used to add a dependency to a Bazel target. The <code>deps</code> attribute exists for all library, binary and test rules. Dependencies are specified as a list of strings. There are several distinct types of dependency:</p>
<ul>
<li><a href="#local-dependencies">Local dependencies</a></li>
<li><a href="#external-dependencies">External dependencies</a></li>
<li><a href="#pip-dependencies-python">Pip dependencies</a>.</li>
</ul>
<p>A simple example that illustrates these is as follows:</p>
<pre><code class="hljs css language-starlark">py_library(
  <span class="hljs-attr">name</span> = <span class="hljs-string">"my_lib"</span>,
  <span class="hljs-attr">srcs</span> = [<span class="hljs-string">"my_lib.py"</span>],
  <span class="hljs-attr">deps</span> = [
    <span class="hljs-string">":my_package_dependency"</span>, <span class="hljs-comment"># This is a local dependency.</span>
    <span class="hljs-string">"//orc8r/magma/common:my_util"</span>, <span class="hljs-comment"># This is a local dependency.</span>
    <span class="hljs-string">"@aioh2_repo//:aioh2"</span>, <span class="hljs-comment"># This is an external dependency.</span>
    requirement(<span class="hljs-string">"grpcio"</span>), <span class="hljs-comment"># This is a pip dependency.</span>
  ],
)
</code></pre>
<p>It is <a href="https://bazel.build/configure/best-practices">best practice</a> to use fine-grained dependencies and to keep targets small, as this allows for better caching and parallelism. Closely connected source files should be contained in the same target for maintainability.</p>
<p>Furthermore, Bazel does not allow circular dependencies among targets. If a circular dependency is present, the build will fail with an error that a cycle in the dependency graph has been detected. The MME service currently does not allow for a finer granularity because circular dependencies are present and therefore larger targets need to be used.</p>
<h4><a class="anchor" aria-hidden="true" id="local-dependencies"></a><a href="#local-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local dependencies</h4>
<p>Dependencies on targets in the <strong>same package</strong>, i.e. the same <code>BUILD.bazel</code> file, are specified by the target name, prefixed by <code>:</code>. For example, as <code>deps = [&quot;:my_package_dependency&quot;]</code>.</p>
<p>Dependencies on targets in <strong>other packages within Magma</strong> are additionally prefixed by <code>//</code> and the path of the respective package relative to the repository root. For example, as <code>deps = [&quot;//orc8r/magma/common:my_util&quot;]</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="external-dependencies"></a><a href="#external-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>External dependencies</h4>
<p>External dependencies can be added to <code>$MAGMA_ROOT/bazel/&lt;language&gt;_repositories.bzl</code>. The target is either defined in the external source (if it is a bazelified dependency) or in the respective build file in <code>$MAGMA_ROOT/bazel/external</code> (if it is a dependency that is not bazelified).</p>
<p>In the <code>deps</code> attribute of the target that needs the external dependency, the name of the external dependency repository is prefixed by <code>@</code> and followed by the Bazel target. For example, as <code>deps = [&quot;@aioh2_repo//:aioh2&quot;]</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="pip-dependencies-python"></a><a href="#pip-dependencies-python" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pip dependencies (Python)</h4>
<p>In most cases, external Python dependencies can be added as pip dependencies. For this, the dependency needs to be added to the <code>$MAGMA_ROOT/bazel/external/requirements.in</code> file. If a new dependency is added, the <code>requirements.txt</code> file needs to be rebuilt by</p>
<pre><code class="hljs css language-bash"><span class="hljs-variable">$MAGMA_ROOT</span>/bazel/external $ pip-compile --allow-unsafe --generate-hashes --output-file=requirements.txt requirements.in
</code></pre>
<p>which requires <code>pip-tools</code> to be installed.</p>
<blockquote>
<p>Info: See <code>bazel/external/requirements_README.md</code> for more information regarding the <code>requirements.in</code> file.</p>
</blockquote>
<p>The pip dependency, e.g. <code>grpcio</code>, can now be added to a target by adding a requirement statement <code>deps = [requirement(&quot;grpcio&quot;)]</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="cleaning"></a><a href="#cleaning" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cleaning</h3>
<p>The Bazel output, i.e. the artifacts, can be cleaned by running <a href="https://bazel.build/docs/user-manual#cleaning-build-outputs"><code>bazel clean</code></a>, which will remove all outputs from all previous builds for all configurations. The entire working tree created by Bazel can be removed by running <code>bazel clean --expunge</code>.</p>
<p>Usually, cleaning should not be needed as Bazel can build incrementally. However, cleaning can be used to reclaim disk space or to recover a consistent state when <a href="#debugging">debugging</a>.</p>
<blockquote>
<p>Info: The <code>bazel clean</code> command does <strong>not</strong> remove the disk caches. To remove the disk caches, the cache folders, e.g. <code>$MAGMA_ROOT/.bazel-cache</code> and <code>$MAGMA_ROOT/.bazel-cache-repo</code>, need to be removed manually. The exact locations of the disk caches may depend on the environment.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="testing"></a><a href="#testing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing</h2>
<p>There are four categories of tests that concern the AGW, each of these categories is covered in the following sections:</p>
<ul>
<li><a href="#unit-tests">Unit tests</a></li>
<li><a href="#lte-integration-tests">LTE integration tests</a></li>
<li><a href="#python-sudo-tests">Python sudo tests</a></li>
<li><a href="#load-tests">Load tests</a></li>
</ul>
<blockquote>
<p>Warning: Note that not all Bazel test targets in the Magma AGW can be executed directly with Bazel. These special targets are tagged in their attributes and the following sections explain how they can be run.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="unit-tests"></a><a href="#unit-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unit tests</h3>
<p>See the <a href="/magma/docs/next/lte/dev_unit_testing">notes on unit testing</a> for more detailed information and examples on unit testing.</p>
<p>The unit tests can be run on any of the Docker <a href="#environments">environments</a> or on the magma-dev VM.</p>
<p>To run unit tests with Bazel, use the command <code>bazel test</code> and then specify the <a href="#targets">Bazel targets</a> using the same <a href="#target-command-line-syntax">command line syntax</a> described in the build section.</p>
<p>For example, to run all unit tests, that are not tagged as manual, run <code>bazel test //...</code> and to run a specific unit test specify the test target directly, e.g. <code>bazel test //lte/gateway/c/core/oai/test/pipelined_client:pipelined_client_test</code>.</p>
<blockquote>
<p>Warning: Testing all targets for the first time, i.e. without any caches, can overwhelm some systems, due to the amount of parallelization. The number of parallel jobs that Bazel runs in parallel can be limited with the <code>--jobs</code> flag, e.g. on a system with 8 physical CPU cores, one could use <code>--jobs 7</code> for the initial build.</p>
</blockquote>
<p>Some useful command line options for unit testing include:</p>
<ul>
<li><code>--cache_test_results=no</code> disables the caching of test results and forces a re-run even if there are no changes.</li>
<li><code>--runs_per_test=&lt;integer&gt;</code> executes all requested test targets exactly <code>&lt;integer&gt;</code>-many times, even if runs are successful. This flag can be used e.g. to detect flaky tests.</li>
<li><code>--flaky_test_attempts=&lt;integer&gt;</code> executes all test targets that have the <code>flaky = True</code> attribute set, up to <code>&lt;integer&gt;</code>-many times. If there are failures, the test is marked as flaky in the results. Test targets with the attribute <code>flaky = False</code> (default) are unaffected.</li>
</ul>
<p>A complete list of <a href="https://bazel.build/reference/command-line-reference">command line arguments</a> can be found in the official Bazel documentation.</p>
<h3><a class="anchor" aria-hidden="true" id="lte-integration-tests"></a><a href="#lte-integration-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LTE integration tests</h3>
<p>Information on how to run the LTE integration tests with Bazel is documented on the <a href="/magma/docs/next/lte/s1ap_tests">s1ap tests</a> page.</p>
<blockquote>
<p><strong>Warning</strong>: If you try to execute a LTE integration test with <code>bazel test</code> you might get a permission error. Do not execute Bazel commands as sudo/root user, because it can break your local Bazel setup!</p>
</blockquote>
<p>The LTE integration tests cannot be executed directly with Bazel because the tests need extensive access to system resources that are not available during the Bazel runtime. In CI, the LTE integration tests are executed directly with pytest. Locally, there is a wrapper script that can be used - for instructions on how to use this script, please refer to the <a href="/magma/docs/next/lte/s1ap_tests">s1ap tests</a> page.</p>
<h3><a class="anchor" aria-hidden="true" id="python-sudo-tests"></a><a href="#python-sudo-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Python sudo tests</h3>
<p>The Python sudo tests are a group of tests for the pipelined and mobilityd services that require root permissions during the test runtime.</p>
<blockquote>
<p><strong>Warning</strong>: Do not execute Bazel commands as sudo/root user, because it can break your local Bazel setup!</p>
</blockquote>
<p>To run all Python sudo tests, start the magma-dev VM and run the script:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
bazel/scripts/run_sudo_tests.sh
</code></pre>
<p>To run individual tests, specify the test target, for example</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
bazel/scripts/run_sudo_tests.sh //lte/gateway/python/magma/pipelined/tests:test_classifier_mme_flow_dl
</code></pre>
<p>To display the full list of supported options, run</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
bazel/scripts/run_sudo_tests.sh --<span class="hljs-built_in">help</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="load-tests"></a><a href="#load-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Load tests</h3>
<blockquote>
<p><strong>Info</strong>: For detailed information on the load tests, please refer to the README file <code>lte/gateway/python/load_tests/README.md</code>.</p>
</blockquote>
<p>To run every load test that is defined inside the <code>LOAD_TEST_LIST</code> of the script <code>bazel/scripts/run_load_tests.sh</code>, run the script on the magma-dev VM from anywhere inside the Magma folder.</p>
<p>For example, for mobilityd's <code>AllocateIPRequest</code>, there is a <code>load_test_mobilityd.py</code> which contains an <code>allocate</code> command (run as <code>load_test_mobilityd.py allocate</code>).</p>
<p>The load tests are defined in Bazel as <code>py_binary</code> targets, because they run as scripts and not as tests.</p>
<h3><a class="anchor" aria-hidden="true" id="generating-unit-test-coverage"></a><a href="#generating-unit-test-coverage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating unit test coverage</h3>
<p>To generate coverage data for unit tests with Bazel, use the command <code>bazel coverage</code> and then specify the unit test targets. Generating unit test coverage can be done on any of the Docker <a href="#environments">environments</a> or on the magma-dev VM.</p>
<p>To generate test coverage data for all C and C++ unit tests, run</p>
<pre><code class="hljs css language-bash">bazel coverage //orc8r/gateway/c/...:* //lte/gateway/c/...:*
</code></pre>
<p>Similarly, to generate test coverage data for all Python unit tests, run</p>
<pre><code class="hljs css language-bash">bazel coverage //orc8r/gateway/python/...:* //lte/gateway/python/...:*
</code></pre>
<p>The coverage data can then be found in the folder <code>$MAGMA_ROOT/bazel-out/_coverage/_coverage_report.dat</code>.</p>
<p>To generate a HTML report, run</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
genhtml bazel-out/_coverage/_coverage_report.dat --output-directory &lt;path/to/output/directory&gt;
</code></pre>
<p>The HTML report can be opened via <code>&lt;path/to/output/directory&gt;/index.html</code>.</p>
<p>For general information on the <code>bazel coverage</code> command, see the <a href="https://bazel.build/configure/coverage">official Bazel documentation</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="running"></a><a href="#running" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running</h2>
<p>The <code>py_binary</code> targets tagged as either <code>service</code> or <code>util_script</code> should not be run with the <code>bazel run</code> command, because their use requires special wrappers.</p>
<h3><a class="anchor" aria-hidden="true" id="services"></a><a href="#services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Services</h3>
<p>The AGW services are running on the magma-dev VM as systemd services, therefore the Bazel-built executables need to be wrapped in a systemd service file. The file templates can be found in the folder <code>$MAGMA_ROOT/lte/gateway/deploy/roles/magma/files/systemd_bazel/</code>.</p>
<p>To learn more about the services, go to the page <a href="/magma/docs/next/lte/readme_agw">AGW Services/Sub-Components</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="utility-scripts"></a><a href="#utility-scripts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Utility scripts</h3>
<p>The AGW utility scripts can be executed independently and they are sometimes called by the services. These scripts are expected to work from any folder on the magma-dev VM, therefore the Bazel-built artifacts are linked to <code>/usr/local/bin/[filename].py</code>. To link the scripts, run</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
bazel/scripts/link_scripts_for_bazel_integ_tests.sh
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-to-run-services-and-scripts"></a><a href="#how-to-run-services-and-scripts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to run services and scripts</h3>
<p>The process for building and running the services and scripts is already automated and documented in the <a href="/magma/docs/next/basics/quick_start_guide">Quick Start Guide</a>. To build all services, on the magma-dev VM, you can use the alias <code>magma-build-agw</code>. For the detailed commands, you can look at the script <code>$MAGMA_ROOT/bazel/scripts/build_and_run_bazelified_agw.sh</code>.</p>
<p>To run an individual utility script, after it was built and linked, execute the name of the file on the magma-dev VM in any directory.</p>
<h2><a class="anchor" aria-hidden="true" id="querying"></a><a href="#querying" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Querying</h2>
<p>Bazel is equipped with a powerful query language, which can be used to analyze information about the targets and packages. The output of a Bazel query can be used as the input for other Bazel commands, this can be achieved, e.g. by using a sub-shell.</p>
<p>Detailed information on the <code>bazel query</code> command, including many examples, can be found on the pages</p>
<ul>
<li><a href="https://bazel.build/query/quickstart">Query quickstart guide</a></li>
<li><a href="https://bazel.build/query/guide">Query guide</a></li>
<li><a href="https://bazel.build/query/language">Bazel query reference</a></li>
</ul>
<p>of the official Bazel documentation.</p>
<p>The remainder of this section contains some Magma AGW specific examples.</p>
<p>To find all test targets that use the Python test rule <code>py_test</code>, run</p>
<pre><code class="hljs css language-bash">bazel query <span class="hljs-string">'kind(py_test, //...)'</span>
</code></pre>
<p>To exclude the Python tests that are tagged as <code>manual</code>, e.g. integration tests, from the output, run</p>
<pre><code class="hljs css language-bash">bazel query <span class="hljs-string">'kind(py_test, //...) except attr(tags, manual, //...)'</span>
</code></pre>
<p>To list all scripts and services, run</p>
<pre><code class="hljs css language-bash">bazel query <span class="hljs-string">"attr(tags, 'service|util_script', kind(.*_binary, //...)"</span>
</code></pre>
<p>To list all C or C++ services, run</p>
<pre><code class="hljs css language-bash">bazel query <span class="hljs-string">"attr(tags, 'service', kind(cc_binary, //...)"</span>
</code></pre>
<p>To create a graph with all dependencies of, e.g. the envoy controller service, excluding external packages, run</p>
<pre><code class="hljs css language-bash">bazel query <span class="hljs-string">'filter("(^[^@])", filter("^(?!.*external)", deps(//feg/gateway/services/envoy_controller )))'</span> --output graph | dot -Tsvg &gt; envoy_controller_deps.svg
</code></pre>
<p>Creating the image requires the <a href="https://graphviz.org/download/">graphviz</a> package to be installed.</p>
<h2><a class="anchor" aria-hidden="true" id="bazel-ci"></a><a href="#bazel-ci" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bazel CI</h2>
<p>In CI, there are several <a href="#workflows">workflows</a> that use Bazel and they are briefly introduced in the following section.</p>
<h3><a class="anchor" aria-hidden="true" id="workflows"></a><a href="#workflows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Workflows</h3>
<ul>
<li><code>agw-coverage.yml</code>: This workflow runs on pull requests and merges to master. It creates and uploads the unit test <a href="#generating-unit-test-coverage">coverage</a> data for C, C++ and Python tests.</li>
<li><code>bazel.yml</code>: This is the main workflow for jobs that use Bazel. The workflow runs on pull requests and merges to master. In order to only run the jobs that are really needed on pull requests, the <a href="#bazel-diff">Bazel-diff</a> tool is used. The workflow contains the
<ul>
<li><a href="#starlark-formatter">starlark format check</a>.</li>
<li>C, C++, Go and Python <a href="#unit-tests">unit tests</a> with the <a href="#configurations">configurations</a>:
<ul>
<li>native/plain</li>
<li><code>asan</code></li>
<li><code>production</code></li>
</ul></li>
<li>build of the Magma and SCTP debian packages.</li>
<li>runtime check that all Python imports in the AGW services are bazelified.</li>
<li>check that all C, C++ and Python files in the repository are bazelified or excluded in the <code>bazel/scripts/check_py_bazel.sh</code> script.</li>
</ul></li>
<li><code>docker-builder-devcontainer.yml</code>: The workflow runs on pull requests and merges to master. If necessary, this workflow builds and uploads the <a href="#environments">Docker environments</a>. This includes in particular the Docker images that contain pre-built Bazel caches that can be used in CI or locally. These cache images are rebuilt regularly.</li>
<li><code>lte-integ-test-bazel-magma-deb.yml</code>: This workflow runs on merges to master. It runs the <a href="#lte-integration-tests">LTE integration tests</a> on the AGW that have been installed via the debian package.</li>
<li><code>sudo-python-tests.yml</code>: This workflow runs on merges to master. It runs the <a href="#python-sudo-tests">Python sudo tests</a>.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="bazel-diff"></a><a href="#bazel-diff" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bazel-diff</h3>
<p><a href="https://github.com/Tinder/bazel-diff">Tinder/bazel-diff</a> is an open-source tool that can determine which Bazel targets are impacted by the changes between two git commits. Bazel-diff is used in the <code>bazel.yml</code> <a href="#workflows">workflow</a> on pull requests to determine if the changes impact</p>
<ul>
<li>the debian package/release build</li>
<li>the Python service import statements</li>
<li>C, C++, Python and Go AGW unit test targets</li>
</ul>
<p>The granularity for the unit tests is individual Bazel test targets, which typically include a single file.</p>
<p>For ease of use, the Bazel-diff tool has been wrapped in a Bash script <code>bazel/scripts/bazel_diff.sh</code>. To determine the impacted targets from after the commit <code>&lt;GIT_SHA_PRE&gt;</code> up to and including the commit <code>&lt;GIT_SHA_POST&gt;</code>, run</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$MAGMA_ROOT</span>
bazel/scripts/bazel_diff.sh &lt;GIT_SHA_PRE&gt; &lt;GIT_SHA_POST&gt;
</code></pre>
<p>The script then outputs the list of impacted targets to stdout.</p>
<h4><a class="anchor" aria-hidden="true" id="filtering-the-bazel-diff-output"></a><a href="#filtering-the-bazel-diff-output" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Filtering the Bazel-diff output</h4>
<p>Using <a href="#querying"><code>bazel query</code></a>, the output of Bazel-diff can be filtered, e.g. for test targets or the release target. In CI, this is done with the script <code>bazel/scripts/filter_test_targets.sh</code>, which takes a Bazel target rule name as a mandatory argument and a tag as an optional second argument.</p>
<p>To filter a list of targets, contained in a file <code>&lt;IMPACTED_TARGETS_FILE&gt;</code>, for test targets of any language, run</p>
<pre><code class="hljs css language-bash">bazel/scripts/filter_test_targets.sh <span class="hljs-string">".*_test"</span> &lt; <span class="hljs-string">"&lt;IMPACTED_TARGETS_FILE&gt;"</span>
</code></pre>
<p>The script will then print the test targets to stdout.</p>
<p>To filter a list of targets for Python services, run</p>
<pre><code class="hljs css language-bash">bazel/scripts/filter_test_targets.sh <span class="hljs-string">"py_binary"</span> <span class="hljs-string">"service"</span> &lt; <span class="hljs-string">"&lt;IMPACTED_TARGETS_FILE&gt;"</span>
</code></pre>
<p>To filter for specific individual targets, like the release build, use <code>grep</code>, e.g.</p>
<pre><code class="hljs css language-bash">grep --quiet <span class="hljs-string">'//lte/gateway/release:release_build'</span> <span class="hljs-string">"&lt;IMPACTED_TARGETS_FILE&gt;"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="release-build"></a><a href="#release-build" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Release build</h2>
<p>To build the Magma, SCTPD and DHCP helper CLI debian packages, with <a href="#configurations">production configuration</a>, locally, run</p>
<pre><code class="hljs css language-bash">bazel run //lte/gateway/release:release_build --config=production
</code></pre>
<p>The target <code>//lte/gateway/release:release_build</code> is a wrapper target for creating the Magma, SCTPD and DHCP helper CLI debian artifacts with the proper versions. Creating the debian packages with <a href="https://github.com/bazelbuild/rules_pkg"><code>rules_pkg</code></a> must be reproducible and a version like <code>1.9.0-1667381719-ebd3bb56</code> (<code>&lt;version&gt;_&lt;timestamp&gt;_&lt;hash&gt;</code>) would produce artifacts that are not reproducible. This target builds the artifacts and changes the version afterwards.</p>
<p>The debian packages that have been built can be found at <code>/tmp/packages/*.deb</code>.</p>
<p>The debian packages are built in CI in the <code>bazel.yml</code> <a href="#workflows">workflow</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="debugging"></a><a href="#debugging" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging</h2>
<p>In this section, we list some steps that can be taken to debug failing Bazel builds.</p>
<ul>
<li>Make sure that the code is in the right state and that the correct <a href="#environments">environment</a> is used.</li>
<li>When debugging failing builds, the <a href="https://bazel.build/docs/user-manual#info"><code>bazel info</code></a> command can be helpful to document the current state of the system and the configurations.</li>
<li>The <a href="#cleaning"><code>bazel clean</code></a> or <code>bazel clean --expunge</code> commands can help to recover a consistent state. Usually, this is not needed between builds as Bazel can build incrementally.</li>
<li>Permission errors can occur when Bazel commands were accidentally run with root permissions. In this case one should update the permissions of the affected files from the host system.</li>
<li>The flags <code>--sandbox_debug --verbose_failures</code> can be used to preserve the <a href="https://bazel.build/docs/sandboxing">sandbox</a> that was used for the build and show the commands that were used to set up the sandbox. To find the Bazel output base, run <code>bazel info output_base</code>. The sandbox will be located below the output base and could be at a path like <code>&lt;output_base&gt;/execroot/__main__/bazel-out/k8-fastbuild/</code>. The option <code>--spawn_strategy=standalone</code> can be used to disable sand-boxing.</li>
<li>To empty the Bazel <a href="#caching">caches</a>, remove the cache folders. They may be located at <code>$MAGMA_ROOT/.bazel-cache</code> and <code>$MAGMA_ROOT/.bazel-cache-repo</code>. Removing the cache folders will significantly slow down the subsequent builds until the caches are filled again. Removing the caches should usually not be necessary.</li>
<li>The <a href="https://bazel.build/rules/performance#performance-profiling">Bazel profile</a> can be used to debug issues related to performance or hardware limitations. The default location for the profile is <code>&lt;output_base&gt;/command.profile.gz</code>. To find the Bazel output base, run <code>bazel info output_base</code>. The option <code>--profile</code> can be used to specify a different path and name for the profile file. Bazel profile files can be opened in the Chromium or Chrome browsers by navigating to <code>chrome://tracing</code> and loading the profile. For more details, see the <a href="https://bazel.build/rules/performance#performance-profiling">official Bazel documentation</a>.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/magma/docs/next/basics/quick_start_guide"><span class="arrow-prev">← </span><span>Quick Start Guide</span></a><a class="docs-next button" href="/magma/docs/next/tutorials/00_overview"><span>Overview</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#what-is-bazel">What is Bazel?</a><ul class="toc-headings"><li><a href="#structure-and-files">Structure and files</a></li><li><a href="#environments">Environments</a></li><li><a href="#caching">Caching</a></li><li><a href="#commands">Commands</a></li></ul></li><li><a href="#building">Building</a><ul class="toc-headings"><li><a href="#targets">Targets</a></li><li><a href="#target-command-line-syntax">Target command line syntax</a></li><li><a href="#configurations">Configurations</a></li><li><a href="#dependencies">Dependencies</a></li><li><a href="#cleaning">Cleaning</a></li></ul></li><li><a href="#testing">Testing</a><ul class="toc-headings"><li><a href="#unit-tests">Unit tests</a></li><li><a href="#lte-integration-tests">LTE integration tests</a></li><li><a href="#python-sudo-tests">Python sudo tests</a></li><li><a href="#load-tests">Load tests</a></li><li><a href="#generating-unit-test-coverage">Generating unit test coverage</a></li></ul></li><li><a href="#running">Running</a><ul class="toc-headings"><li><a href="#services">Services</a></li><li><a href="#utility-scripts">Utility scripts</a></li><li><a href="#how-to-run-services-and-scripts">How to run services and scripts</a></li></ul></li><li><a href="#querying">Querying</a></li><li><a href="#bazel-ci">Bazel CI</a><ul class="toc-headings"><li><a href="#workflows">Workflows</a></li><li><a href="#bazel-diff">Bazel-diff</a></li></ul></li><li><a href="#release-build">Release build</a></li><li><a href="#debugging">Debugging</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2025 The Magma Authors</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f95caeb7bc059b294eec88e340e5445b',
                indexName: 'magma',
                inputSelector: '#search_input_react'
              });
            </script></body></html>