<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>QoS Policy Configuration · Magma Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# QoS Policy Configuration and Cleanup"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="QoS Policy Configuration · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# QoS Policy Configuration and Cleanup"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="text/javascript" src="/init.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Magma Website</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/magma/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma/magma/wiki/Contributor-Guide" target="_self">Contributing</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://wiki.magmacore.org/" target="_self">Wiki</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Access Gateway</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/quick_start_guide">Quick Start Guide</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/bazel/agw_with_bazel">AGW with Bazel</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Operate your own private mobile network with Charmed Magma</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/00_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/01_getting_started">1. Getting Started</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/02_deploying_magma_orchestrator">2. Deploying Magma Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/03_deploying_magma_agw">3. Deploying Magma Access Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/04_integrating_agw_with_orc8r">4. Integrating Magma Access Gateway with Magma Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/05_deploying_the_radio_simulator">5. Deploying the radio simulator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/06_simulating_user_traffic">6. Simulating user traffic</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/tutorials/06_destroying_the_env">7. Destroying the environment</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Usage<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">How-To</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/ue_metering">UE Usage Metering</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/config_agw_bridged">AGW Non-NAT Mode</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/5g_nsa_support">5G NSA Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/call_tracing">Call Tracing</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/events_monitoring">Events Monitoring</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/ipv6_agw">(Experimental) Configure IPv6 AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/he_api">Header Enrichment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/inbound_roaming">Inbound Roaming</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/l3_transport">L3 transport for AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/network_probe">Network Probe</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/package">Packaging</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dashboard">Dashboard</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/equipment">Equipment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/network">Network</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/subscriber">Subscriber</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/traffic">Traffic</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/metrics">Metrics</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/alerts">Alerts</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/federation">Federation</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/admin">Admin</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/tips_and_tricks">Tips and Tricks</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/architecture_overview">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/architecture_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/architecture_modularity">Modularity</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/architecture_security">Security</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/architecture_overview">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">FeG</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/architecture_overview">Overview</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Domain Proxy</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/dp/architecture_overview">Overview</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Deploy<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/general/aws_cloudstrapper">AWS Cloudstrapper Install</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_install">Install AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_install_docker">Install Docker AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_config_agw">Configure AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_config_enodebd">Configure eNodeB</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_config_apn">Configure an APN</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/deploy_agw_using_juju">Deploy AGW using Juju</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/build_install_magma_pkg_in_agw">Build and install a magma package in AGW</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_install">Install Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_using_ansible">Deploy Orchestrator using Ansible (Beta)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_using_juju">Deploy Orchestrator using Juju (Beta)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_terraform_options">Terraform Options</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_faq">FAQs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/deploy_setup">Set Up NMS</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federation Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_build">Build FeG</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_install">Install FeG</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Domain Proxy</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/dp/deploy_build">Build and deployment</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Carrier WiFi</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/deploy_build">Building Carrier Wifi Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/deploy_install">Installing Carrier Wifi Gateway</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Configure<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/configure_agw_ha">Configure AGW for HA</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/configure_sentry">Sentry Integration</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/configure_thanos">Thanos</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federation Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/configure_federation">Configure FeG</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/nms_organizations">Multitenancy (Organizations)</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Upgrade<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/general/upgrade_intro">Introduction</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_debian_to_ubuntu">Migrate AGWs to Ubuntu</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_6">Upgrade to v1.6</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_5">Upgrade to v1.5</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_4">Upgrade to v1.4</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_3">Upgrade to v1.3</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_2">Upgrade to v1.2</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/upgrade_1_1">Upgrade to v1.1</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_6">Upgrade to v1.6</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_5">Upgrade to v1.5</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_4">Upgrade to v1.4</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_3">Upgrade to v1.3</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_2">Upgrade to v1.2</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/upgrade_1_1">Upgrade to v1.1</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Debug<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/agw_healthcheck">Perform Access Gateway health check</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/agw_unable_to_checkin">Access Gateway Unable to Check-in to Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/user_unable_to_attach">User is unable to attach to Magma</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/update_certificates">Update rootCA and controller SSL certificates</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/generate_admin_operator_certificates">Generate and update admin_operator certificates</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/analyze_service_crashes_in_agw">Analyze Service crashes in AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/howtos/troubleshooting/datapath_connectivity">Debugging AGW datapath issues</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/debug_show_tech">Show Tech</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/debug_dp_probe">Datapath Probe CLI</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/debug_user_control_plane">User Control Plane trace CLI</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federated Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/debug_cli">FeG CLI</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Carrier WiFi</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/healthchecker">Health Checker</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/pipelined_packet_tracer_debugging">Pipelined Packet Tracer Debugging</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/debug_logs">View Logs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/alerts_troubleshooting">Alerts</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Domain Proxy</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/dp/debug_logs">Debugging and logs</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Contribute<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_github">Community</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_codeowners">Codeowners Workflow</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_tsc_norms">TSC Processes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/contributing/contribute_proposals">Proposals Process</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Technical Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/resources/ref_pcap">PCAP Collection</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/resources/ref_useful_links">Useful Links</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/resources/ref_magma_metrics">Life of a Magma Metric</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/readme_agw">Services/Sub-Components</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/dev_notes">Developer Notes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/openvswitch">Magma Datapath</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/pipelined">Pipelined</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/ebpf_datapath">Magma eBPF Datapath</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/ipfix">Magma IPFIX Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/pipelined_tests">Pipelined testing framework</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/dev_unit_testing">Test AGW</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/tr069">Add eNB TR-069 Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/s1ap_tests">S1AP Integration Tests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/eventd">Event Reporting</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/sessiond">Session Management in Magma</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/access_service_restrictions">Restricting Network Access</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/dev_teid_allocation">TEID Allocation</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/integrated_5g_sa">Integrated 5G SA</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/extended_5g_sa_features">Extended 5G SA Features</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/suci_extensions">SUCI Extensions</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/redirectd">Redirection</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/readme_callflow">Building the Callflow</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_rest_api">REST API</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_build">Build Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_testing">Test Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_minikube">Deploy on Minikube</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_security">Security</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_indexers">State Indexers</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_sub_digests">Subscriber Digests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_rest_api_auth">REST API Auth</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_dependencies">Module Dependencies</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_gateway_registration">Gateway Registration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/dev_aws_stack">AWS Stack</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_spacing">Spacing Guidelines</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_testing">Test NMS</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_themes">Themes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/dev_components">Components</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Federation Gateway</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/dev_testing">Test Federation Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/docker">FeG Docker Setup</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/s1ap_federated_tests">S1AP Federated Integration Tests</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/session_proxy">Session Proxy</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Carrier WiFi</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/cwf/dev_testing">Test CWAG</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Design Documents<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">General</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p001_vpn_config_from_api">Configurable VPN from Orchestrator API</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p005_call_tracing">Call Tracing for Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p014_proposal_process">Magma Proposals</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p015_tech_debt_week">Tech Debt Week Processes</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p017_apn_refactoring">APN Refactoring Proposal</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Access Gateway</h4><ul><li class="navListItem navListItemActive"><a class="navItem" href="/magma/docs/next/proposals/p003_qos_enforcement">QoS Policy Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p004_fua_restrict_feature">Service Restriction Feature</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p007_header_enrichment">Header enrichment</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p008_apn_correction">MME APN Correction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p013_Ubuntu_upgrade">AGW Ubuntu upgrade</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p018_control_network_metrics">Export Control Path Network Metrics</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p019_enodeb_cbrs_support">Enodebd CBRS Support</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p020_sgi_tunnel_transport">L3 transport for AGW</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p002_scaled_prometheus_pipeline">Scaled Prometheus Pipeline</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p010_subscriber_scaling">Subscriber Scaling</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p011_victoriametrics">VictoriaMetrics as Magma&#x27;s TSDB</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">NMS</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p009_nms_mariadb_migration">NMS MariaDB Migration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/proposals/p016_nms_regression_testing">NMS Regression Testing</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">FAQ<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/faq/faq_magma">Frequently Asked Questions</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="qos-policy-configuration-and-cleanup"></a><a href="#qos-policy-configuration-and-cleanup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>QoS Policy Configuration and Cleanup</h1>
<p><em>Status: Accepted</em><br>
<em>Author: @andreilee</em><br>
<em>Last Updated: 08/13</em></p>
<p>This document concerns:</p>
<ol>
<li>The addition of configurable QoS for policies</li>
<li>The addition of more comprehensive associations between subscribers, QoS,
policies, and APN</li>
<li>The enforcement of the above with an eventually consistent model</li>
<li>Details concerning implementing these changes in both
federated/un-federated environments</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="use-cases-and-capabilities-to-be-enabled"></a><a href="#use-cases-and-capabilities-to-be-enabled" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use Cases and Capabilities to Be Enabled</h2>
<p>We would like to enable QoS enforcement across the APN and bearer level.</p>
<h3><a class="anchor" aria-hidden="true" id="private-lte"></a><a href="#private-lte" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Private LTE</h3>
<p>As an example use case for QoS enforcement, a service provider may wish to
segment users into tiers denoting their service quality, eg. bronze, silver,
and gold. A service provider should then be able configure a QoS profiles for
each of the three service levels.</p>
<p>Policy rules will each be assigned one of these QoS profiles. The same QoS
profile may be assigned to multiple rules.</p>
<p>Beyond segmenting subscribers into QoS levels, as our support for multi-APN
matures, we wish to enable QoS enforcement for multiple sessions
of a single subscriber, one for each APN. Across these different sessions, each
APN will have a different QoS for its default bearer. To enable this behavior,
there should be the capability to assign a QoS profile to an APN for the
default bearer.</p>
<p>It is also possible that a network operator would desire to have SGi
specified differently for each APN even when served from the same gateway.</p>
<p>We will define the <code>ApnResource</code> as a configuration specifying how SGi
interfaces are set up for an APN in a gateway.</p>
<p>To enable the above, we have the following list of new API requirements for
Magma:</p>
<ul>
<li>(1) Configuration of policy QoS profiles</li>
<li>(2) Configuration of APN entities</li>
<li>(3) Configuration of ApnResource entities</li>
<li>(4) Assignment of APN entities to subscribers (to denote which APNs a subscriber has access to)</li>
<li>(5) Assignment of ApnResource entities to gateways</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="federated-lte"></a><a href="#federated-lte" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Federated LTE</h3>
<p>In federated use cases, we have slightly different requirements. APN entities
may not need to be configured as they are provided by the federation network.
<code>ApnResource</code> entities will still need to be configured for the AGW.</p>
<p>We also wish to support cases where an HSS is not provided, and our
<code>subscriberdb</code> service is used, but where the PCRF is federated,
and so our <code>policydb</code> service is disabled.</p>
<p>Due to different federation requirements between operators who federate HSS,
Gx/Gy, or both, the following requirement is added:</p>
<ul>
<li>(6) Split our <code>relay_enabled</code> flag for enabling federation into two separate
flags, <code>hss_relay_enabled</code>, and <code>gx_gy_relay_enabled</code></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="how-we-will-change-magma"></a><a href="#how-we-will-change-magma" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How We Will Change Magma</h2>
<h3><a class="anchor" aria-hidden="true" id="api-endpoints"></a><a href="#api-endpoints" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Endpoints</h3>
<p>To enable configuration of QoS profiles and APNs, we will support the
following REST endpoints:</p>
<pre><code class="hljs css language-text">Policy QoS Profiles

GET     /lte/{network_id}/policy_qos_profiles
POST    /lte/{network_id}/policy_qos_profiles

GET     /lte/{network_id}/policy_qos_profiles/{qos_name}
PUT     /lte/{network_id}/policy_qos_profiles/{qos_name}
DELETE  /lte/{network_id}/policy_qos_profiles/{qos_name}

GET     /feg_lte/{network_id}/policy_qos_profiles
POST    /feg_lte/{network_id}/policy_qos_profiles

GET     /feg_lte/{network_id}/policy_qos_profiles/{qos_name}
PUT     /feg_lte/{network_id}/policy_qos_profiles/{qos_name}
DELETE  /feg_lte/{network_id}/policy_qos_profiles/{qos_name}


APN Configuration

GET     /lte/{network_id}/apns
POST    /lte/{network_id}/apns

GET     /lte/{network_id}/apns/{apn_name}
PUT     /lte/{network_id}/apns/{apn_name}
DELETE  /lte/{network_id}/apns/{apn_name}

GET     /feg_lte/{network_id}/apns
POST    /feg_lte/{network_id}/apns

GET     /feg_lte/{network_id}/apns/{apn_name}
PUT     /feg_lte/{network_id}/apns/{apn_name}
DELETE  /feg_lte/{network_id}/apns/{apn_name}


APN Resources

GET     /lte/{network_id}/gateways/{gateway_id}/resource_labels
POST    /lte/{network_id}/gateways/{gateway_id}/resource_labels

GET     /lte/{network_id}/gateways/{gateway_id}/resource_labels/{resource_label}
PUT     /lte/{network_id}/gateways/{gateway_id}/resource_labels/{resource_label}
DELETE  /lte/{network_id}/gateways/{gateway_id}/resource_labels/{resource_label}

GET     /feg_lte/{network_id}/gateways/{gateway_id}/resource_labels
POST    /feg_lte/{network_id}/gateways/{gateway_id}/resource_labels

GET     /feg_lte/{network_id}/gateways/{gateway_id}/resource_labels/{resource_label}
PUT     /feg_lte/{network_id}/gateways/{gateway_id}/resource_labels/{resource_label}
DELETE  /feg_lte/{network_id}/gateways/{gateway_id}/resource_labels/{resource_label}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="api-entity-definitions"></a><a href="#api-entity-definitions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Entity Definitions</h3>
<p>Entity definitions for QoS, APN, and subscribers will change.
The final state is summarized here:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">policy_qos_profile:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">string</span>
  <span class="hljs-attr">class_id:</span> <span class="hljs-string">enum[0,255]</span>
  <span class="hljs-attr">max_req_bw_dl:</span> <span class="hljs-string">uint32</span>
  <span class="hljs-attr">max_req_bw_ul:</span> <span class="hljs-string">uint32</span>
  <span class="hljs-comment"># Guaranteed bit rate</span>
  <span class="hljs-comment"># Not enforced by Magma yet</span>
  <span class="hljs-attr">gbr:</span>
    <span class="hljs-attr">gbr_ul:</span> <span class="hljs-string">uint32</span>
    <span class="hljs-attr">gbr_dl:</span> <span class="hljs-string">uint32</span>
  <span class="hljs-comment"># Allocation and retention priority</span>
  <span class="hljs-comment"># Not enforced by Magma yet</span>
  <span class="hljs-attr">arp:</span>
    <span class="hljs-attr">arp_priority_level:</span> <span class="hljs-string">uint32</span>
    <span class="hljs-attr">arp_preemption_capability:</span> <span class="hljs-string">bool</span>
    <span class="hljs-attr">arp_preemption_vulnerability:</span> <span class="hljs-string">bool</span>
</code></pre>
<p>This is an addition, as there is an existing <code>qos_profile</code> definition, which
will continue to be used only for the <code>apn_configuration</code> entity.</p>
<p>This <code>policy_qos_profile</code> will be marshalled to the <code>FlowQos</code> protobuf
message.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">flow_qos:</span>
  <span class="hljs-string">...</span>
</code></pre>
<p>The <code>policy_qos_profile</code> will replace the <code>flow_qos</code> swagger entity
in funtctionality.
<code>flow_qos</code> should be marked as deprecated and should be discouraged from further
use in the API.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">apn_configuration:</span>
  <span class="hljs-string">...</span>
  <span class="hljs-comment"># Unchanged</span>
  <span class="hljs-string">...</span>
</code></pre>
<p>As before, a single QoS profile will be associated to an APN object at creation.
This will define the QoS for the default bearer, in combination with the <code>ambr</code>
field, and is unchanged.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">apn_resource:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">string</span>
  <span class="hljs-comment"># Identifies that the SGi interface is set up for the specified APN</span>
  <span class="hljs-attr">apn_name:</span> <span class="hljs-string">string</span>
  <span class="hljs-comment"># Specify either VLAN or the interface name for SGi</span>
  <span class="hljs-comment"># VLAN to use when communicating over SGi interface</span>
  <span class="hljs-attr">vlan_id:</span> <span class="hljs-string">string</span>
</code></pre>
<p>The <code>apn_resource</code> defines how the APN is serviced by each access gateway.
Options are provided for IP allocation, and the uplink. It is possible that
two APNs are serviced by separate uplink interfaces on the same access gateway.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">mutable_lte_gateway:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">string</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">string</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">apn_resources:</span> <span class="hljs-string">array[string]</span>
  <span class="hljs-string">...</span>
</code></pre>
<p>We are adding the <code>apn_resources</code> field to <code>lte_gateway</code> and
<code>mutable_lte_gateway</code> and they are specified by ID.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">network_epc_configs:</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">hss_relay_enabled:</span> <span class="hljs-string">bool</span>
  <span class="hljs-attr">gx_gy_relay_enabled:</span> <span class="hljs-string">bool</span>
  <span class="hljs-string">...</span>
</code></pre>
<p>The <code>relay_enabled</code> flag will be split to enable federation under different
circumstances, with finer control. The combination of <code>hss_relay_enabled</code> and
<code>gx_gy_relay_enabled</code> together have the same functionality as the current
<code>relay_enabled</code>.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">subscriber:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">string</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>
  <span class="hljs-string">...</span>
  <span class="hljs-attr">active_base_names:</span> <span class="hljs-string">array[base_name]</span>
  <span class="hljs-comment"># Policy IDs listed in active_policies define which policies will be installed</span>
  <span class="hljs-comment"># for every APN of the subscriber</span>
  <span class="hljs-attr">active_policies:</span> <span class="hljs-string">array[string]</span>
  <span class="hljs-comment"># Keyed by APN IDs, and values list out the policy IDs</span>
  <span class="hljs-comment"># Keys present define the APNs that the subscriber has access to</span>
  <span class="hljs-comment"># policy IDs define what policies will be installed for the subscriber for</span>
  <span class="hljs-comment"># each APN</span>
  <span class="hljs-attr">active_policies_by_apn:</span> <span class="hljs-string">dict[string,</span> <span class="hljs-string">array[string]]</span>
  <span class="hljs-string">...</span>
</code></pre>
<p>To now specify APN-specific policies, the field <code>active_policies_by_apn</code> will
be added. If an APN key is not present in <code>active_policies_by_apn</code>, then the
subscriber does not have access to that APN.</p>
<p>To ensure that edges are maintained correctly in <code>configurator</code>, a backend
entity <code>apn_policy_profile</code> should be maintained (and not visible through the
API). This <code>apn_policy_profile</code> should have no fields, but only edges. The
subscriber will have edges to its own <code>apn_policy_profile</code>s, and each
<code>apn_policy_profile</code> will have edges to policies to identify which policies
are installed for each (IMSI, APN) combination. Each APN will also have edges
to its corresponding <code>apn_policy_profile</code>s. When policies are deleted, then
the subscriber will no longer be assigned those policies for its APNs. When APNs
are deleted, each subscriber should no longer have assignments to policies for
those APNs.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">policy_rule:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">string</span>
  <span class="hljs-attr">flow_list:</span> <span class="hljs-string">array[flow_description]</span>
  <span class="hljs-attr">priority:</span> <span class="hljs-string">uint32</span>
  <span class="hljs-attr">rating_group:</span> <span class="hljs-string">uint32</span>
  <span class="hljs-attr">monitoring_key:</span> <span class="hljs-string">string</span>
  <span class="hljs-string">...</span>
  <span class="hljs-comment"># Set to be deprecated and replaced by qos_profile</span>
  <span class="hljs-attr">qos:</span> <span class="hljs-string">flow_qos</span>
  <span class="hljs-comment"># Refers to the ID of the qos_profile</span>
  <span class="hljs-attr">qos_profile:</span> <span class="hljs-string">string</span>
</code></pre>
<p>One QoS object can be associated to each policy object.
The same QoS object can be associated to multiple different policies.</p>
<p><code>policy_qos_profile</code> replaces the <code>flow_qos</code> in functionality, but because of
the change from 1:1 mapping used previously for <code>flow_qos</code>, a new field is
introduced instead of reusing the old field.</p>
<p>A migration is required to create a <code>qos_profile</code> for each <code>flow_qos</code>, and
assign it to the corresponding <code>policy_rule</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="pipelined-changes-for-enforcement"></a><a href="#pipelined-changes-for-enforcement" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pipelined Changes for Enforcement</h3>
<p>At a high level, changes in <code>pipelined</code> are required to support the following:</p>
<ul>
<li>(P1) Enforce QoS via AMBR across the bearer level, and APN level (not
subscriber level, as UE_AMBR is enforced on RAN side)</li>
<li>(P1) Enforce VLAN specification in <code>apn_resource</code> definition supplied to the
gateway for each APN</li>
<li>(P2) Load/KPI reporting (to be used for admission control and session
lifecycle management by sessiond)</li>
<li>(P3) GBR enforcement</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="policydb-changes-with-streaming"></a><a href="#policydb-changes-with-streaming" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Policydb Changes with Streaming</h3>
<p>The <code>policydb</code> service across the orc8r and gateway requires changes to support
QoS enforcement:</p>
<ul>
<li>(P1) Rename <code>relay_enabled</code> flag to <code>gx_gy_relay_enabled</code></li>
<li>(P1) Orc8r <code>policydb</code> service should be updated to stream to the gateway
all the mappings between basenames, policies, QoS profiles, APNs, data plans
and subscribers</li>
<li>(P1) Gateway <code>policydb</code> service should interface with <code>sessiond</code> to trigger
rule activations/deactivations when there are updates to subscribers'
active policies. This will occur through a new gRPC service implemented by
<code>sessiond</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="session-manager-changes"></a><a href="#session-manager-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session Manager Changes</h3>
<p>The session manager will be changed to support the following:</p>
<ul>
<li>(P1) Provide gRPC methods for <code>policydb</code> to set the policies installed for
each subscriber</li>
<li>(P1) Accept the default QoS profile with APN that is received from MME</li>
<li>(P1) Dedicated bearer Life Cycle Management (LCM): Associations of policies
(with QoS fields) with the subscribers will define the lifecycle of
dedicated bearers</li>
<li>(P2) Admission control and pre-emption. This is enforcing the AMBR fields
specified in the current <code>apn_configuration</code></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="policydb-and-session-manager-grpc-interface"></a><a href="#policydb-and-session-manager-grpc-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Policydb and Session Manager gRPC Interface</h2>
<p>As specified in the previous two sections, <code>sessiond</code> will provide a gRPC
service for <code>policydb</code> to set installed policies for attached subscribers.</p>
<p>An outline of the gRPC service is as follows:</p>
<pre><code class="hljs css language-grpc"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SessionPolicySet</span> </span>{
  <span class="hljs-built_in">bool</span> apply_subscriber_wide = <span class="hljs-number">1</span>;
  <span class="hljs-built_in">string</span> apn = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">repeated</span> StaticRuleInstall static_rules = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">repeated</span> DynamicRuleInstall dynamic_rules = <span class="hljs-number">4</span>;
}

<span class="hljs-comment">// Send only for subscribers for which there were updates</span>
<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SubscriberPolicySet</span> </span>{
  <span class="hljs-built_in">string</span> imsi = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">repeated</span> SessionPolicySet = <span class="hljs-number">2</span>;
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">SubscriberPolicyUpdates</span> </span>{
  <span class="hljs-keyword">repeated</span> SubscriberPolicySet policies_subscriber = <span class="hljs-number">1</span>;
}

<span class="hljs-class"><span class="hljs-keyword">service</span> <span class="hljs-title">SessionUpdateResponder</span> </span>{
  <span class="hljs-comment">// Update the specified subscribers with the currently active rules</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-function"><span class="hljs-keyword">rpc</span> UpdateActiveRules (SubscriberPolicyUpdates) <span class="hljs-keyword">returns</span> (magma.orc8r.Void) {}
}
</span></code></pre>
<p>It is expected that <code>policydb</code> will receive streamer updates of active rules
from the orc8r. For all subscribers that have updated active rules, it will
call <code>UpdateActiveRules</code> to update <code>sessiond</code> on all subscribers for which
there were changes. For the subset of which there are subscribers connected
on the gateway, <code>sessiond</code> will enforce rule changes.</p>
<p>To ensure that rule activations/deactivations are not missed, a P2 goal is to
ensure that <code>policydb</code> will periodically update <code>sessiond</code> on subscribers for
which no streamed updates were received.</p>
<h3><a class="anchor" aria-hidden="true" id="subscriberdb-changes"></a><a href="#subscriberdb-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscriberdb Changes</h3>
<ul>
<li>(P1) Rename <code>relay_enabled</code> to <code>hss_relay_enabled</code></li>
<li>(P1) Stream down to the gateway the default QoS policy, and <code>apn_resource</code>
as part of the APN Configuration</li>
<li>(P1) Send to <code>mobilityd</code> the updated <code>ApnConfiguration</code> including default
QoS policy and <code>apn_resource</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="mobilityd-changes"></a><a href="#mobilityd-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mobilityd Changes</h3>
<ul>
<li>(P1) Accept the updated <code>ApnConfiguration</code> protobuf with included QoS policy,
and <code>apn_resource</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="nms-changes"></a><a href="#nms-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NMS Changes</h3>
<p>Our front-end interface needs to change to allow these configurations to be
made easily. These are second priority. Some API changes cause
backwards-compatibility issues and will need to be updated soon.</p>
<ul>
<li>(P2) ApnResource configuration on creation/edit of LTE gateways</li>
<li>(P2) Apn Profile creation/edit modals</li>
<li>(P2) Policy QoS Profile creation/edit modals</li>
<li>(P2) Policy creation/edit includes fields to specify QoS</li>
<li>(P2) LTE network creation/edit includes fields to specify supported APNs</li>
<li>(P2) Subscriber creation/edit includes fields to specify policy assignments
per APN</li>
<li>(P2) Creation of APN entities disabled when HSS is federated</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="feg-changes"></a><a href="#feg-changes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FeG Changes</h3>
<ul>
<li>(P1) Split support of <code>relay_enabled</code> into <code>hss_relay_enabled</code> and
<code>gx_gy_relay_enabled</code></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/magma/docs/next/proposals/p017_apn_refactoring"><span class="arrow-prev">← </span><span>APN Refactoring Proposal</span></a><a class="docs-next button" href="/magma/docs/next/proposals/p004_fua_restrict_feature"><span>Service Restriction Feature</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#use-cases-and-capabilities-to-be-enabled">Use Cases and Capabilities to Be Enabled</a><ul class="toc-headings"><li><a href="#private-lte">Private LTE</a></li><li><a href="#federated-lte">Federated LTE</a></li></ul></li><li><a href="#how-we-will-change-magma">How We Will Change Magma</a><ul class="toc-headings"><li><a href="#api-endpoints">API Endpoints</a></li><li><a href="#api-entity-definitions">API Entity Definitions</a></li><li><a href="#pipelined-changes-for-enforcement">Pipelined Changes for Enforcement</a></li><li><a href="#policydb-changes-with-streaming">Policydb Changes with Streaming</a></li><li><a href="#session-manager-changes">Session Manager Changes</a></li></ul></li><li><a href="#policydb-and-session-manager-grpc-interface">Policydb and Session Manager gRPC Interface</a><ul class="toc-headings"><li><a href="#subscriberdb-changes">Subscriberdb Changes</a></li><li><a href="#mobilityd-changes">Mobilityd Changes</a></li><li><a href="#nms-changes">NMS Changes</a></li><li><a href="#feg-changes">FeG Changes</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2025 The Magma Authors</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f95caeb7bc059b294eec88e340e5445b',
                indexName: 'magma',
                inputSelector: '#search_input_react'
              });
            </script></body></html>